"use strict";var typeValue="",stack=[];let global_source_id,global_type,preQuantity=0,global_submit=!0;function calculateTotalQty(){var t=0;return $(".no_units").each(function(){t+=parseFloat($(this).val()?validateNumbers($(this).val()):0)}),t}function checkItemQuantity(t){$(".no_units").length;global_submit=!0,$(".no_units").each(function(e,a){var n=$(this).attr("data-id"),i=parseFloat(validateNumbers($(this).val()));if("#adjustment-edit-container"==t)var o=parseFloat($(this).attr("old-qty")?$(this).attr("old-qty"):0);if("STOCKOUT"==$("#type").val())$.ajax({method:"POST",url:SITE_URL+"/stock_adjustment/check-item-qty",data:{item_id:n,_token:token,source:$("#location").val()}}).done(function(e){e=JSON.parse(e);"#adjustment-add-container"==t?Number(i)>Number(e.qty)&&(swal(e.qty+" "+jsLang("item(s) available in stock"),{icon:"error"}),$("#qty_"+n).addClass("error"),l=calculateTotalQty(),$("#total_qty").text(getDecimalNumberFormat(l)),global_submit=!1):"#adjustment-edit-container"==t&&($("#qty_"+n).attr("data_max",data_max>0?data_max:Number(o)+Number(e.qty)),Number(i)>Number(o)+Number(e.qty)&&(swal(getDecimalNumberFormat(e.qty)+" "+jsLang("item(s) available in stock"),{icon:"error",buttons:[!1,jsLang("Ok")]}),$("#qty_"+n).addClass("error"),global_submit=!1))});else{var l=calculateTotalQty();$("#total_qty").text(l),$("#total_quantity").val(l)}})}function deleteAddedRows(){$(".addedRow").each(function(){$(this).closest("tr").remove()})}function deleteItemRow(t,e){stack=jQuery.grep(stack,function(t){return t!=e}),"#adjustment-edit-container"==t&&(stack.pop(e),stack.splice($("#rowid"+e).attr("id"))),$("#rowid"+e).remove();var a=calculateTotalQty();$("#total_qty").text(getDecimalNumberFormat(a)),"#adjustment-add-container"==t?$("#total_quantity").val(a):$("#total_quantity").val(getDecimalNumberFormat(a))}function in_array(t,e){for(var a=0;a<e.length;a++)if(e[a]==t)return!0;return!1}if($(document).on("keydown",".no_units",function(t){preQuantity=$(this).val()}),$(document).on("click",".no_units",function(t){$(".labelMindata-max").css("display","none")}),$(document).on("click",function(t){$(".labelMindata-max").css("display","none"),$(".labelMindata-max").css("position","fixed")}),($(".main-body .page-wrapper").find("#adjustment-add-container").length||$(".main-body .page-wrapper").find("#adjustment-edit-container").length)&&($(".js-example-basic-single").select2(),$("#adjustment-edit-container select").prop("disabled",!0),$("#transferTbl").DataTable({responsive:!0,language:{url:app_locale_url},paging:!1,searching:!1,bInfo:!1,ordering:!1}),$("#no_div").hide(),$(document).ready(function(){$(".error").hide(),$(window).keydown(function(t){if(13==t.keyCode)return t.preventDefault(),!1})})),$(".main-body .page-wrapper").find("#adjustment-add-container").length&&($("#datepicker").daterangepicker(dateSingleConfig(),function(t,e){var a=moment(t,"MMMM D, YYYY").format(dateFormat);$("#datepicker").val(a)}),$(document).on("click",".delete_item",function(){deleteItemRow("#adjustment-add-container",$(this).attr("id"))}),$(document).on("change keyup",".no_units",function(){checkItemQuantity("#adjustment-add-container")}),$("#transferForm").validate({rules:{type:{required:!0},location:{required:!0},date:{required:!0},"quantity[]":{required:!0}},messages:{"quantity[]":{required:jsLang("Required")}}}),$(document).on("change","#location",function(){stack=[],$(".error").hide(),$("#errorMessage").text(" ");$("#location").val(),$(this).val();null!=global_source_id&&1==$("#transferTbl tr").hasClass("addedRow")?swal({title:jsLang("Are you sure?"),text:jsLang("Change of location will reset added products/services, please confirm you really want to do this."),icon:"warning",buttons:[jsLang("Cancel"),jsLang("Ok")],dangerMode:!0}).then(t=>{t?(global_source_id=$("#location").val(),$(".closeRow").trigger("click"),deleteAddedRows(),$("#total_qty").text("0")):($("#location").val(global_source_id),$("#location").trigger("change.select2"))}):global_source_id=$("#location").val(),""!=global_source_id&&$("#source-error").css("display","none"),$("#type").val()&&$("#location").val()&&$("#error_message").html("")}),$(document).on("change","#type",function(){stack=[],$(".error").hide(),$("#errorMessage").text(" "),typeValue=$("#type").val(),null!=global_type&&1==$("#transferTbl tr").hasClass("addedRow")?swal({title:jsLang("Are you sure?"),text:jsLang("Change of type will reset added products/services, please confirm you really want to do this."),icon:"warning",buttons:[jsLang("Cancel"),jsLang("Ok")],dangerMode:!0}).then(t=>{t?(global_type=$("#type").val(),$(".closeRow").trigger("click"),deleteAddedRows(),$("#total_qty").text("0")):($("#type").val(global_type),$("#type").trigger("change.select2"))}):global_type=$("#type").val(),""!=global_type&&$("#type-error").css("display","none")}),$("#adjustment-add-container #search").autocomplete({delay:500,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(t,e){var a=$("#type").val(),n=$("#location").val();return a?($("#error_message").html(""),a&&!n?($("#error_message").html(jsLang("Please select Source")),$("#location").select2("open"),!1):void $.ajax({url:SITE_URL+"/adjustment/search",type:"post",dataType:"json",data:{_token:token,search:t.term,location:n},success:function(t){if(1==t.status_no){$("#val_item").html();t=t.items;$("#no_div").css("display","none"),e($.map(t,function(t){return{id:t.id,value:t.name,available:t.available,is_stock_managed:t.is_stock_managed}}))}else $(".ui-menu-item").remove(),$("#no_div").css("display","block")}})):($("#error_message").html(jsLang("Please select Type and Source")),$("#type").select2("open"),a&&($("#location").select2("open"),$("#error_message").html("")),$("html, body").animate({scrollTop:0},500),!1)},select:function(t,e){var a=e.item;if(a.id){if(1==a.is_stock_managed&&a.available<=0&&"STOCKOUT"==$("#type").val())return swal(a.available+" "+jsLang("item(s) available in stock"),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1;if(in_array(a.id,stack))$("#qty_"+a.id).val(function(t,e){return e=validateNumbers(e),"STOCKOUT"==$("#type").val()&&parseFloat(a.available)<parseFloat(e)+1?(swal(a.available+" "+jsLang("item(s) available in stock"),{icon:"error",buttons:[!1,jsLang("Ok")]}),getDecimalNumberFormat(e)):Number.isInteger(parseFloat(e))?($("#qty_"+a.id).trigger("change"),parseFloat(++e)):($("#qty_"+a.id).trigger("change"),getDecimalNumberFormat(++e))});else{var n='<tr class="addedRow" id="rowid'+a.id+'"><td class="text-center">'+a.value+'</div><input type="hidden" name="description[]" value="'+a.value+'"><input type="hidden" name="stock[]" value="'+a.id+'"></td><td><input class="form-control text-center no_units positive-float-number" stock-id="'+a.id+'" id="qty_'+a.id+'" data-id="'+a.id+'" type="text" name="quantity[]" value="1"><label id="qty_'+a.id+'-error" class="error labelMindata-max" for="qty_'+a.id+'"></label><div id="errorMessage-'+a.id+'" class="color_red f-bold"><input type="hidden" name="id[]" value="'+a.id+'"></td><td class="text-center"><button id="'+a.id+'" class="btn btn-xs btn-danger delete_item"><i class="feather icon-trash-2"></i></button></td></tr>';stack.length<=0&&$(".dataTables_empty").parent().remove(),$("#item-body").append(n),stack.push(a.id)}$(this).val(""),"STOCKOUT"==$("#type").val()&&$.ajax({method:"POST",url:SITE_URL+"/stock_adjustment/check-item-qty",data:{item_id:a.id,_token:token,source:$("#location").val()}}).done(function(t){t=JSON.parse(t);$("#qty_"+t.id).attr("data-max",t.qty);var e=$("#qty_"+a.id).val();if(t.qty<Number(e)){$("#qty_"+t.id).attr("data-max",t.qty),$("#qty_"+a.id).trigger("change"),$("#errorMessage").html(t.message);var n=calculateTotalQty();$("#total_qty").text(getDecimalNumberFormat(n))}});var i=calculateTotalQty();return $("#total_qty").text(getDecimalNumberFormat(i)),$("#total_quantity").val(i),!1}},minLength:1,autoFocus:!0}).on("focus",function(){$(this).autocomplete("search")}).autocomplete("instance")._renderItem=function(t,e){var a;return a=1==e.is_stock_managed?e.available:"-",$("<li>").append("<div>"+e.value+"<br>"+jsLang("Available")+" : "+a+"</div>").appendTo(t)},$(document).on("click","#btnSubmit",function(){return $("#item-body tr").hasClass("odd")||0==$("#item-body tr").length?(swal(jsLang("Please select at least one item."),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1):$("#item-body tr").length>0&&0==calculateTotalQty()?(swal(jsLang("Quantity can not be zero or empty."),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1):global_submit})),$(".main-body .page-wrapper").find("#adjustment-edit-container").length){$(document).on("click",".delete_item",function(){deleteItemRow("#adjustment-edit-container",$(this).attr("id"))}),$(document).on("change",".no_units",function(){checkItemQuantity("#adjustment-edit-container")}),$("#transferForm").validate({rules:{type:{required:!0},location:{required:!0},date:{required:!0},"item_quantity[]":{required:!0},"new_item_quantity[]":{required:!0}}});var totalQty=0,oldQuantity=0,data_max=0;$("#adjustment-edit-container #search").autocomplete({delay:500,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(t,e){$("#type").val();var a=$("#location").val();$.ajax({url:SITE_URL+"/adjustment/search",type:"post",dataType:"json",data:{_token:token,adjustment_id:adjustmentId,type:adjustmentType,search:t.term,location:a},success:function(t){if(1==t.status_no){$("#val_item").html();t=t.items;$("#no_div").css("display","none"),e($.map(t,function(t){return{id:t.id,value:t.name,available:t.available,is_stock_managed:t.is_stock_managed}}))}else $(".ui-menu").remove(),$("#no_div").css("display","block")}})},select:function(t,e){var a=e.item;if(a.id){if("STOCKOUT"==$("#type").val()&&1==a.is_stock_managed&&a.available<=0)return swal(a.available+" "+jsLang("item(s) available in stock"),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1;if(in_array(a.id,stack)){var n=$("#qty_"+a.id).attr("data-max"),i=validateNumbers($("#qty_"+a.id).val());1==a.is_stock_managed&&n<parseFloat(i)+1?swal(n+" "+jsLang("item(s) available in stock"),{icon:"error",buttons:[!1,jsLang("Ok")]}):Number.isInteger(parseFloat(i))?$("#qty_"+a.id).val(parseInt(++i)):$("#qty_"+a.id).val(getDecimalNumberFormat(++i))}else{var o='<tr class="addedRow" id="rowid'+a.id+'"><td class="text-center">'+a.value+'<input type="hidden" name="new_description[]" value="'+a.value+'"><input type="hidden" name="new_stock[]" value="'+a.id+'"></td><td> <input class="form-control text-center no_units positive-float-number" data-id="'+a.id+'" data-rate="'+a.price+'" type="text" id="qty_'+a.id+'" name="new_item_quantity[]" value="1"><label id="qty_'+a.id+'-error" class="error labelMindata-max" for="qty_'+a.id+'"></label><div id="errorMessage-'+a.id+'"class="color_red f-bold"></div><input type="hidden" name="new_item_id[]" value="'+a.id+'"></td><td class="text-center"><button id="'+a.id+'" class="btn btn-xs btn-danger delete_item"><i class="feather icon-trash-2"></i></button></td></tr>';$("#item-body").append(o),stack.push(a.id)}$(this).val("");var l=calculateTotalQty();return $("#total_qty").text(getDecimalNumberFormat(l)),$("#total_quantity").val(getDecimalNumberFormat(l)),!1}},minLength:1,autoFocus:!0}).on("focus",function(){$(this).autocomplete("search")}).autocomplete("instance")._renderItem=function(t,e){var a;return a=1==e.is_stock_managed?e.available:"-",$("<li>").append("<div>"+e.value+"<br>"+jsLang("Available")+" : "+a+"</div>").appendTo(t)},$(document).on("click","#btnSubmit",function(){return 0==$("#item-body tr").length?(swal(jsLang("Please select at least one item."),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1):$("#item-body tr").length>0&&0==calculateTotalQty()?(swal(jsLang("Quantity can not be zero or empty."),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1):global_submit})}$(".main-body .page-wrapper").find("#adjustment-list-container").length&&($(document).on("click","#csv, #pdf",function(t){t.preventDefault(),window.location=SITE_URL+"/stock/adjustment-"+this.id+"?to="+$("#endto").val()+"&from="+$("#startfrom").val()+"&trans_type="+$("#trans_type").val()+"&location="+$("#destination").val()}),$(".list-container #dataTableBuilder").addClass("stock-transfer-list")),$("#stock-details-container").find("#dataTableBuilder").length&&$("#dataTableBuilder").DataTable({responsive:!0,language:{url:app_locale_url},paging:!1,searching:!1,bInfo:!1,ordering:!1});