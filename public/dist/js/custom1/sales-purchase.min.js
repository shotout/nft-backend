"use strict";var spinner='<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>',taxSelect="";function autoCompleteSource(e,a,t,n,o=1){var r=$("#inv-type").val(),s="",c=$(n).val(),i=$(n+"option:selected").attr("data-currency_id"),l=$("#inv-exchange-rate").val();if($(".inv-exchange-rate").append('<input type="hidden" name="global_exchangeRate" id="global_exchangeRate" value="'+l+'">'),!c)return"#customers"==n?$("#error_message").html(jsLang("Please select customer first")):$("#error_message").html(jsLang("Please select supplier first")),$("html, body").animate({scrollTop:0},500),$(n).select2("open"),!1;$("#error_message").html(""),s="quantity"==r?"product":"service",$.ajax({url:t,dataType:"json",type:"POST",data:{_token:token,search:e.term,currency_id:i,type:s,exchange_rate:l,salesTypeId:o,loc_code:$("#location").val()},success:function(e){if(1==e.status_no){e=e.items;$("#no_div").css("display","none"),a($.map(e,function(e){return{id:e.id,stock_id:e.stock_id,description:e.description,value:e.name,units:e.units,price:e.price,tax_rate:e.tax_rate,tax_id:e.tax_id,qty:e.qty,hsn:e.hsn,is_stock_managed:e.is_stock_managed,available:e.available}}))}else $(".ui-menu-item").remove(),$("#no_div").css("top",$("#search").position().top+35),$("#no_div").css("left",$("#search").position().left),$("#no_div").css("width",$("#search").width()),$("#no_div").css("display","block")}})}function autoCompleteSelect(e,a,t){var n=$(".itemRow").length,o=[];"add"==e?(rowNo=-1,n>0&&(itemRowEach(o),rowNo=Math.max.apply(Math,o))):"edit"==e&&itemRowEach(o);rowNo;rowNo++;var r="",s='<select name="item_tax['+a.id+"]["+rowNo+'][]" class="inputTax form-control bootstrap-select selectpicker" multiple>',c="";"add"==e?$.each(taxes,function(e,t){var n="";a.tax_id==t.id&&(n="selected");var o=getDecimalNumberFormat(t.tax_rate);c+="<input type='hidden' class='itemTaxAmount itemTaxAmount-"+t.id+"'>",r+="<option title='"+o+"%' value='"+t.id+"' "+n+" taxrate='"+o+"'>"+t.name+"("+o+")</option>"}):"edit"==e&&$.each(taxes,function(e,a){c+="<input type='hidden' class='itemTaxAmount itemTaxAmount-"+a.id+"'>",r+="<option title='"+a.tax_rate+"%' value='"+a.id+"' taxrate='"+a.tax_rate+"'>"+a.name+"("+a.tax_rate+")</option>"}),taxSelect=s+r+"</select>"+c;$("option:selected",t).data("symbol");a.hsn||(a.hsn="")}function itemRowEach(e){$(".itemRow").each(function(){e.push($(this).attr("data-row-no"))})}function allTax(e,a){$.each($(e),function(e,t){var n=$(this).attr("data-taxes"),o=$(this).attr("id").split("-");n&&$("#rowId-"+o[1]).find(a).selectpicker("val",JSON.parse(n))})}function checkStack(e,a=null){return stack&&0!=stack.length&&("invoice_add"==a||"purchase_add"==a?null!=$("#reference_no").val()&&""!=$("#reference_no").val()&&$("#btnSubmit").prop("disabled",!1):$("#btnSubmit").prop("disabled",!1)),$(".addRow").attr("data-row-no",e),$(".addRowContainer").attr("id","addRow-"+e),!1}function checkItemSelected(e,a=".itemRow"){if($(a).length<1)return swal(jsLang(e),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1}function customItem(e,a,t,n=".addRow"){$(document).on("click",n,function(){if("add"==e){if(!$(a).val())return $("#error_message").html(t),$("html, body").animate({scrollTop:0},500),$(a).select2("open"),!1;$("#error_message").html(""),changeCustomItemText()}else"edit"==e&&changeCustomItemText()})}function customItemValidation(e){"quantity"==$("#inv-type").val()&&$(e).validate({rules:{"custom_item_qty[]":{required:!0,number:!0}}})}function changeCustomItemText(){(0==checkBlank()||$(".custom-item").length<1)&&(addNewRow(),$(".inputDiscountType").select2()),$(".custom-item").length>=1&&("hours"==$("#inv-type").val()?$(".addRow").text(jsLang("Add more custom service")):$(".addRow").text(jsLang("Add more custom item")))}function customerOrSupplierModal(e,a,t){$("#theModal").on("show.bs.modal",function(n){var o=$(n.relatedTarget),r=$(this);r.find(".modal-body").html(spinner),$("#theModalSubmitBtn").removeClass(e).removeClass("btn_add_note").removeClass("btn_add_shipping").removeClass("btn_add_discount").removeClass("order_hold").removeClass("edit_order"),$(".modal-dialog").removeClass("modal-lg"),o.data("label")==a&&(r.find("#theModalSubmitBtn").text(jsLang("Submit")).addClass(e),$(".modal-dialog").addClass("modal-lg"),r.find("#theModalLabel").text(t)),r.find(".modal-body").load(o.data("remote"))})}function deleteModal(){$("#theModal").on("show.bs.modal",function(e){var a=$(e.relatedTarget),t=$(this);$("#theModalSubmitBtn").attr("data-task","").removeClass("delete-task-btn"),"Delete"==a.data("label")?(t.find("#theModalSubmitBtn").addClass("delete-task-btn").attr("data-task",a.data("id")).text(jsLang("Delete")).show(),t.find("#theModalLabel").text(a.data("title")),t.find(".modal-body").text(a.data("message"))):(t.find(".modal-body").html(spinner),t.find(".modal-body").load(a.data("remote")))})}function exchangeRateValue(e,a){var t=parseFloat(e).toFixed(exchange_rate_decimal_digits);"."==thousand_separator?t=numberWithDot(t):","==thousand_separator&&(t=numberWithCommas(t)),$(a).val(t)}function formatEquivalentAmount(){if($("#account_currency").is(":visible"))var e=Number($("option:selected","#account_currency").val());else e=Number($("option:selected","#currency").val());var a=Number($("#exchange_rate").val());isNaN(a)&&(a=validateNumbers($("#exchange_rate").val())),e&&e!=dflt_currency_id?$.ajax({method:"POST",url:SITE_URL+"/get-currency-exchange-rate",data:{fromCurrency:e,toCurrency:dflt_currency_id,_token:token},dataType:"json",success:function(e){exchangeRateValue(e,"#exchange_rate");var a=e,t=due;$("#incoming_amount").val(getDecimalNumberFormat(t)),a>0?$("#amount").val(getDecimalNumberFormat(t/a)):a<0&&($("#amount").val(getDecimalNumberFormat(t*e)),$("#exchange_rate").val(getDecimalNumberFormat(e)))}}):($("#amount").val(getDecimalNumberFormat(due)),$("#incoming_amount").val(getDecimalNumberFormat(due)))}function getTodayExchangeRate(e,a){$.ajax({method:"POST",url:SITE_URL+"/get-currency-exchange-rate",data:{toCurrency:e,date:a,fromCurrency:defaultCurrencyId,_token:token},dataType:"json",success:function(e){$("#search").removeAttr("disabled"),exchangeRateValue(e.toFixed(exchange_rate_decimal_digits),"#inv-exchange-rate")}})}function hideNoDiv(){$(document).on("click",function(e){$("#no_div").hide()})}function in_array(e,a){var t;for(t=0;t<a.length;t++)if(a[t]==e)return!0;return!1}function onChangeLocation(e="#location"){let a=$(e).val();$(e).on("change",function(){$(".itemRow").length>0&&swal({title:jsLang("Are you sure?"),text:jsLang("Change of location will reset added products/services, please confirm you really want to do this."),icon:"warning",buttons:[jsLang("Cancel"),jsLang("Ok")],dangerMode:!0}).then(t=>{t?($(".closeRow").trigger("click"),a=$(e).val()):($(e).val(a),$(e).trigger("change.select2"))}),""!=$("#search").val()&&$("#search").trigger("keydown")})}function onChangeSupplierOrCustomer(e){let a;var t;$("#search").val("");var n=$("option:selected",this).data("currency_id"),o=currencySymbol=$("option:selected",this).data("symbol");$("option:selected",this).data("name");t="#supplier"==e?"Change of supplier will reset added products/services, please confirm you really want to do this.":"Change of customer will reset added products/services, please confirm you really want to do this.",$(".itemRow").length>0?swal({title:jsLang("Are you sure?"),text:jsLang(t),icon:"warning",buttons:[jsLang("Cancel"),jsLang("Ok")],dangerMode:!0}).then(t=>{t?("#customers"==e&&($("#inputOtherDiscount").val("0"),$("#inputShipping").val("0"),$("#customAmountDescription").val(""),$("#inputCustomAmount").val("0")),a=$(e).val(),$(".closeRow").trigger("click")):($(e).val(a),$(e).trigger("change.select2")),"#customers"==e&&($(".currencySymbol").text(o),n=$("option:selected",this).data("currency_id"),o=currencySymbol=$("option:selected",this).data("symbol"),$("option:selected",this).data("name"),resetCurrencySymbol())}):("#customers"==e&&$(".currencySymbol").text(o),a=$(e).val(),resetCurrencySymbol()),""!=a&&($("#error_message").html(""),$(e+"-error").css("display","none")),"#supplier"==e&&resetCurrencySymbol();var r=$("#datepicker").val();$("#error_message").html("");var s="#customers"==e?"#customer":e;""!=a?($("#inv-currency").val()!=n&&getTodayExchangeRate(n,r),$("#inv-currency").val(n),showExchangeRate("#supplier"==e?"#supplier":"#customers"),$(".currencySymbol").text(o),$.ajax({method:"POST",url:SITE_URL+"/customer/billing-address",data:{id:a,type:e,_token:token}}).done(function(e){var a=JSON.parse(e),t="";1==a.status?(null!=a.supplier.city&&(t+=a.supplier.city),null!=a.supplier.zipcode&&(t+="-"+a.supplier.zipcode),null!=a.supplier.state&&(t+=", "+a.supplier.state),null!=a.supplier.country&&(t+=", "+a.supplier.country.name),$(s+"-address").html(t),$(s+"-address").css("display","flex"),$(s+"-address-left").css("display","flex")):2==a.status?(null!=a.customer.billing_city&&(t+=a.customer.billing_city),null!=a.customer.billing_zip_code&&(t+="-"+a.customer.billing_zip_code),null!=a.customer.billing_state&&(t+=", "+a.customer.billing_state),null!=a.customer.billing_country&&(t+=", "+a.customer.billing_country.name),$(s+"-address").html(t),$(s+"-address").css("display","flex"),$(s+"-address-left").css("display","flex")):($(s+"-address").html(""),$(s+"-address").css("display","none"),$(s+"-address-left").css("display","none")),""!=$("#search").val()&&$("#search").focus().trigger("keydown").trigger("keyup")})):($("#exchangeRateBlock").hide(),$(s+"-address").html(""))}function onChangeTax(e){$(".taxRow").hide(),$.each($(e),function(e,a){0!=$(this).val()&&$.each($(this).val(),function(e,a){$("#taxRow-"+a).show()})})}function onChangePaymentMethod(e){paymentMethod=$(this).val(),paymentMethodName=$("option:selected",this).attr("data-methodName"),"sales"==e?$("#account_div, #incoming_amount_div, #exchange_rate_div").css("display","flex"):$("#account_div, #incoming_amount_div, #account_balance, #exchange_rate_div").hide(),$("#amount_message").removeClass("text-danger").html(""),$("#account_no").val(""),$("#currency").val("").attr("disabled",!1),$("#select2-currency-container, #select2-account_no-container").text(jsLang("Select One")),$("#set_account_balance").val(null),$("#currency").val(invoiceCurrency).trigger("change"),$("#currency_div").css("display","flex"),paymentMethodName&&($("#setPaymentMethodName").val(paymentMethodName),paymentMethodName=paymentMethodName.toLowerCase(),"bank"==paymentMethodName?$("#account_div").css("display","flex").removeClass("mb-0"):$("#account_div").css("display","none")),$("#amount").removeClass("error"),$("#amount-error").text("")}function onChangeCurrency(e,a){if($("#exchange_rate").val(1),""==$("option:selected","#currency").val()||"undefined"==$("option:selected","#currency").text()?($("#incoming_amount_div").css("display","none"),$("#exchange_rate_div").css("display","none"),formatEquivalentAmount()):($("#incoming_amount_div").css("display","flex"),$("#exchange_rate_div").css("display","flex")),$("#amount_currency_code").text($("option:selected","#currency").text()),$("#incoming_currency").text(invoiceCurrencyName),$("#exchange_rate_currency_code").text(invoiceCurrencyName),$("#currency").val()&&$("#setCurrency").val($("#currency").val()),$("#account_div").removeClass("mb-0"),e!=a){if("bank"!=paymentMethodName){var t=$("#currency").val();$("#token").val();""!=t&&($("#account_no-error").hide(),$("#incoming_amount_div").css("display","flex"),$("#exchange_rate_div").css("display","flex"),formatEquivalentAmount())}else formatEquivalentAmount();$("#incoming_amount_div").css("display","flex"),$("#exchange_rate_div").css("display","flex")}else $("#incoming_amount").val(null),$("#incoming_amount_div").css("display","none"),$("#exchange_rate_div").css("display","none"),formatEquivalentAmount();$("#amount").removeClass("error"),$("#amount-error").text("")}function onKeyUpAmountExchangeRate(){$(document).on("keyup","#amount, #exchange_rate",function(){$("#setCurrency").val($("#currency").val());Number($("option:selected","#currency").val());var e=Number($("#exchange_rate").val()),a=parseFloat(validateNumbers($("#amount").val()));isNaN(e)&&(e=validateNumbers($("#exchange_rate").val())),"bank"==paymentMethodName&&""!=$("#account").val()&&0!=a&&$.ajax({method:"POST",url:SITE_URL+"/transfer/check-balance",data:{account_no:$("#account_no").val(),_token:token}}).done(function(e){var a=Number(e);validateNumbers($("#amount").val())>a?($("#amount_message").addClass("text-danger").html("<strong>"+jsLang("Not sufficent balance in the account")+"</strong>"),$("#pay-button").attr("disabled","disabled")):($("#pay-button").removeAttr("disabled"),$("#amount_message").removeClass("text-danger").html(""))}),0==e?$("#incoming_amount").val(getDecimalNumberFormat(0)):$("#incoming_amount").val(getDecimalNumberFormat(a*e))})}function onChangeAccountNo(e){$("#amount_message").removeClass("text-danger").html("");var a=$("#account_no option:selected").attr("data-currency");$("#setCurrency").val(a);var t=$("#account_no option:selected").attr("data-code");$("#amount_currency_code").text(t),$("#incoming_currency").text(invoiceCurrencyName);var n=$("#token").val();$("#datepicker").val();""!=a&&($("#account_no-error").hide(),$("#incoming_amount_div").css("display","flex"),$("#exchange_rate_div").css("display","flex")),Number($("#account_no option:selected").attr("data-currency"))===Number(dflt_currency_id)&&($("#incoming_amount_div").css("display","none"),$("#exchange_rate_div").css("display","none"),$("#exchange_rate").trigger("input")),void 0===t&&(t=$("#currency-symbol").val(),$("#incoming_amount_div").css("display","none"),$("#exchange_rate_div").css("display","none"),formatEquivalentAmount());$("#payment_method").val();var o='<option selected value="'+$("option:selected","#account_no").attr("data-currency")+'">'+$("option:selected","#account_no").attr("data-code")+"</option>",r=$("#account_no").val(),s=validateNumbers($("#incoming_amount").val());"purchase"==e&&$.ajax({method:"POST",url:SITE_URL+"/transfer/check-balance",data:{account_no:r,_token:n}}).done(function(e){var a=$("#account_no option:selected").attr("currency-symbol"),t=Number(s),n=Number(e);$("#set_account_balance").val(n||0),0==n&&""==r?($("#account_div").removeClass("mb-0"),$("#account_balance_div").hide(),$("#account_balance").css("display","flex")):($("#account_balance_div").css("display","flex"),n>0&&($("#account_balance").css("display","flex"),$("#account_div").addClass("mb-0")),$("#account_balance").text(jsLang("Available Balance :")+a+getDecimalNumberFormat(n)),t>parseFloat(n)&&$("#errorMessage").html(jsLang("Insufficient balance")),t<=parseFloat(n)&&$("#errorMessage").html(""))}),"bank"==paymentMethodName&&($("#account_currency").attr("disabled",!0).append(o),$("#setCurrency").val($("#account_currency").val()),""==r?($("#account_div").css("display","flex"),$("#account_currency_div").css("display","none"),$("#currency_div").hide()):""!=r?($("#account_currency_div").css("display","flex"),$("#currency_div").css("display","none")):($("#account_currency_div").css("display","none"),$("#currency_div").css("display","flex"),$("#account_div").removeClass("mb-0"),$(".message").removeClass("text-danger").html("")),$("#currency-error").hide()),Number($("#account_currency").val())==Number(dflt_currency_id)?($("#incoming_amount").val(null),$("#incoming_amount_div").css("display","none"),$("#exchange_rate_div").css("display","none"),formatEquivalentAmount()):($("#incoming_amount_div").css("display","flex"),$("#exchange_rate_div").css("display","flex"),formatEquivalentAmount()),r?formatEquivalentAmount():($("#currency").val(invoiceCurrency).trigger("change"),$("#currency").attr("disabled",!1),$("#currency_div").css("display","flex"))}function payModal(){$("#payModal form")[0].reset(),$("#payment_method").val("").trigger("change"),$("#payment_date").daterangepicker(dateSingleConfig(),function(e,a){$("#payment_date").val(moment(e,"MMMM D, YYYY").format(dateFormat.toUpperCase()))});var e=$("#amount").val(),a=$("#exchange_rate").val();$("#amount").removeClass("error").val(getDecimalNumberFormat(e)),$("#amount-error").text(""),$("#exchange_rate").val(getDecimalNumberFormat(a))}function payFormAjaxCall(){$.ajax({type:"POST",url:$("#payForm").attr("action"),data:$("#payForm").serialize(),dataType:"json",success:function(e){1==e.status?($("#payModal").modal("toggle"),$(".spinner").show(),$(".spinner").css("line-height","0"),swal(e.message,{icon:"success",buttons:[!1,jsLang("Ok")]}),location.reload()):($(".spinner").hide(),swal(e.message,{icon:"error",buttons:[!1,jsLang("Ok")]}))},error:function(e){$(".spinner").hide(),swal(jsLang("Oops! Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})}function referenceNo(e,a){$(document).on("keyup","#reference_no",function(){var t=$(this).val();if($(this).val(t.replace(/[^0-9]/g,"")),null==t||""==t)return $("#errMsg").html(jsLang("This field is required.")).removeClass("text-success").addClass("text-danger"),void $("#btnSubmit").attr("disabled","disabled");$("#errMsg").html("").removeClass("text-danger"),$("#btnSubmit").removeAttr("disabled");var n=e+$(this).val();$("#reference_no_write").val(n),null==t&&""==t||$.ajax({method:"POST",url:a,data:{ref:n,_token:token}}).done(function(e){1==(e=JSON.parse(e)).status_no?($("#errMsg").html(jsLang("Reference exist")).removeClass("text-success").addClass("text-danger"),$("#btnSubmit").attr("disabled","disabled")):2==e.status_no?($("#errMsg").html(""),$("#errMsg").removeClass("text-danger"),$("#btnSubmit").removeAttr("disabled")):($("#errMsg").html(jsLang("This field is required.")).removeClass("text-success").addClass("text-danger"),$("#btnSubmit").attr("disabled","disabled"))})})}function submitCustomerOrSupplierModal(e,a){$("#theModalSubmitBtn").on("click",function(t){$(this).hasClass(e)&&$(a).trigger("submit")})}function showExchangeRate(e){$("#datepicker").val();$("option:selected",e).data("currency_id")==defaultCurrencyId?($("#exchangeRateBlock").hide(),$("#inv-exchange-rate").val(1)):$("#exchangeRateBlock").css("display","block")}function checkIsAvailable(e){let a=!0;return $(".inputQty").each(function(t,n){var o=$(this).val(),r=$(this).attr("data-max");if("invoice"==e&&0==parseFloat(validateNumbers(o)))return swal(jsLang("Quantity can not be zero"),{icon:"error",buttons:[!1,jsLang("Ok")]}),$(this).addClass("error"),a=!1,!1;1==$(this).attr("data-is_stock_managed")&&parseFloat(r)<parseFloat(validateNumbers(o))&&(swal(r+jsLang(" item(s) available in stock"),{icon:"error",buttons:[!1,jsLang("Ok")]}),$(this).addClass("error"),a=!1)}),a}function checkDiscountAmount(){var e=$("#totalValue").val(),a=validateNumbers($("#shippingTotal").text());if(""!=e&&null!=e&&(e="."==thousand_separator?e.toString().replace(".",""):e.toString().replace(",","")),e-a<0)return swal(jsLang('"Discount amount can not be more than the total amount'),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1}
