"use strict";function dropdownClick(){document.getElementById("inv-dropdown-content").classList.show()}let zero=0;var global_inv_type,previous,allowToTriggerClickOnClose=!1;function itemDescriptionColspan(){var t=$("#colspan").val();$("#invItemHSN").is(":checked")&&(t=parseInt(t)+1),$("#invItemDiscount").is(":checked")&&(t=parseInt(t)+2),$("#invItemTax").is(":checked")&&(t=parseInt(t)+1),$(".inputItemDescription").parent().attr("colspan",t)}$("#inv-type").on("change",function(){var t;$(".itemRow").length>0?(t="invoice"==$(this).attr("data-type")?"Change of invoice type will reset added products, please confirm you really want to do this.":"Change of purchase type will reset added products, please confirm you really want to do this.",swal({title:"Are you sure?",text:t,icon:"warning",buttons:!0,dangerMode:!0}).then(t=>{t?(global_inv_type=$("#inv-type").val(),$(".closeRow").trigger("click"),resetEverythingExcept(),onChangeInvType()):($("#inv-type").val(global_inv_type),$("#inv-type").trigger("change.select2"))})):(global_inv_type=$("#inv-type").val(),resetEverything(),onChangeInvType())}),$("#purchase-receive-type").on("change",function(){$("#purchase_receive_type").val($("#purchase-receive-type").val())}),$("#invItemTax").on("change",function(){$(this).is(":checked")?($(".itemTax").show(),$("#tax_type_div").show(),$(".itemTaxExtra").show(),$("#invItem-Tax").val("on")):($("#tax_type_div").hide(),$(".itemTaxExtra").hide(),$(".itemTax").hide(),$(".taxRow").hide(),$(".inputTax").val(getDecimalNumberFormat(zero)),$(".selectpicker").selectpicker("render"),$(".indivisualTax").val(getDecimalNumberFormat(zero)),$(".inputPrice").trigger("keyup"),$("#invItem-Tax").val("")),itemDescriptionColspan(),$(".inputPrice").trigger("keyup")}),$("#invItemDiscount").on("change",function(){$(this).is(":checked")?($(".itemDiscount").show(),$("#invItem-Discount").val("on"),$(".inputDiscount").val(getDecimalNumberFormat(zero)).show()):($(".itemDiscount").hide(),$(".inputDiscount").val(getDecimalNumberFormat(zero)),$(".indivisualDiscount").val(getDecimalNumberFormat(zero)),$(".inputPrice").trigger("keyup"),$("#invItem-Discount").val("")),itemDescriptionColspan(),$(".inputPrice").trigger("keyup")}),$("#invItemDetails").on("change",function(){$(this).is(":checked")?($(".inputItemDescription").show(),$("#invItem-Details").val("on")):($(".inputItemDescription").hide().val(""),$("#invItem-Details").val(""))}),$("#invItemHSN").on("change",function(){$(this).is(":checked")?($(".itemHSN").show(),$("#invItem-hsn").val("on")):($(".itemHSN").hide(),$(".inputHSN").val(""),$("#invItem-hsn").val("")),itemDescriptionColspan()}),$("#invOtherDiscount").on("change",function(){$(this).is(":checked")?($(".otherDiscount").show(),$("#inv-other-discount").val("on")):($(".otherDiscount").hide(),$("#inputOtherDiscount").val(getDecimalNumberFormat(zero)).trigger("keyup"),$("#inv-other-discount").val("")),$(".inputPrice").trigger("keyup")}),$("#invShipping").on("change",function(){$(this).is(":checked")?($(".shippingAmount").show(),$("#inv-shipping").val("on")):($(".shippingAmount").hide(),$("#inputShipping").val(getDecimalNumberFormat(zero)).trigger("keyup"),$("#inv-shipping").val("")),$(".inputPrice").trigger("keyup")}),$("#invCustomAmount").on("change",function(){$(this).is(":checked")?($(".customAmount").show(),$("#inv-custom-amount").val("on")):($(".customAmount").hide(),$("#inputCustomAmount").val(getDecimalNumberFormat(zero)).trigger("keyup"),$("#customAmountDescription").val(""),$("#inv-custom-amount").val(""),$("#customAmountDescription-error").text(""),$("#inputCustomAmount-error").text("")),$(".inputPrice").trigger("keyup")}),$("#inv-currency").on("change",function(){var t=$("option:selected",this).attr("data-symbol");$(".currencySymbol").text(t)}),$("#discount-on").on("change",function(){$("#discount_on").val($("#discount-on").val()),$(".inputPrice").trigger("keyup")}),$("#tax-type").on("change",function(){$("#tax_type").val($("#tax-type").val()),$(".inputPrice").trigger("keyup")}),$(document).on("change",".inputQty",function(){var t=validateNumbers($(this).val())*validateNumbers($(this).parent().parent().find(".inputPrice").val());isNaN(t)&&(t=0),$(this).parent().parent().find(".indivisualTotal").text(decimalNumberFormatWithCurrency(t)),$(".inputPrice").trigger("keyup")}),$(document).on("keyup",".inputPrice",function(){var t=validateNumbers($(this).val())*validateNumbers($(this).parent().parent().find(".inputQty").val());isNaN(t)&&(t=0),$(this).parent().parent().find(".indivisualTotal").text(decimalNumberFormatWithCurrency(t)),$.each($(".inputPrice"),function(){calculateHiddenDiscount($(this)),calculateHiddenTax($(this))}),generateAllTotal(),generateOtherDiscount()});var prevDiscountAmount=0;$(document).on("focus",".inputDiscount",function(){""==(prevDiscountAmount=$(this).val())&&(prevDiscountAmount=getDecimalNumberFormat(0))}),$(document).on("change",".inputDiscount",function(){var t=!0,e=$(this).parent().next().children().eq(1).val(),i=parseFloat(validateNumbers($(this).val())),a=$(this).parent().siblings(".itemAmount").text();"%"==e&&i>100?(t=!1,swal(jsLang("Discount amount can not be more than 100%"),{icon:"error"})):"$"==e&&parseFloat(i)>parseFloat(validateNumbers(a))&&(t=!1,swal(jsLang("Discount amount can not be more than")+a,{icon:"error"})),t||(prevDiscountAmount=getDecimalNumberFormat(validateNumbers(0)),$(this).val(prevDiscountAmount)),calculateHiddenDiscount($(this)),calculateHiddenTax($(this)),generateAllTotal()}),$(document).on("change",".inputDiscountType",function(){var t=!0,e=$(this).val(),i=parseFloat(validateNumbers($(".inputDiscount").val())),a=$(".inputDiscount").parent().siblings().eq(6).text();"%"==e&&i>100?(t=!1,swal("Discount amount can't be more than 100%",{icon:"error"})):"$"==e&&parseFloat(i)>parseFloat(validateNumbers(a))&&(t=!1,swal("Discount amount can't be more than "+a,{icon:"error"})),t||(prevDiscountAmount=getDecimalNumberFormat(validateNumbers(0)),$(".inputDiscount").val(prevDiscountAmount)),$(this).parent().parent().find(".inputTax").trigger("change")}),$(document).on("change",".inputTax",function(){$(".inputPrice").trigger("keyup"),"quantity"==$("#inv-type option:selected").val()&&0==$(".indivisualTax").val()&&$(".filter-option-inner-inner").text(jsLang("Nothing Selected"))});let prevOtherDiscountAmount=0;function checkBlank(){var t=!1;return $.each($(".custom-item"),function(e,i){""==$(i).val()&&($(i).focus(),t=!0)}),t}function addNewRow(){var t=[],e=-1;$(".itemRow").length>0&&($(".itemRow").each(function(){t.push($(this).attr("data-row-no"))}),e=Math.max.apply(Math,t)),e++;var i=window.taxes,a="",n='<select id="itemtaxrow-'+e+'" name="custom_item_tax['+e+'][]" class="inputTax form-control bootstrap-select selectpicker" multiple>',r="";$.each(i,function(t,e){r+="<input type='hidden' class='itemTaxAmount itemTaxAmount-"+e.id+"'>",a+="<option title='"+getDecimalNumberFormat(e.tax_rate)+"%' value='"+e.id+"' taxrate='"+getDecimalNumberFormat(e.tax_rate)+"'>"+e.name+"("+getDecimalNumberFormat(e.tax_rate)+")</option>"});var o=n+a+"</select>"+r,u=window.rowHtml=`<tbody id="rowId-${e}">\n            <tr class="itemRow rowNo-${e}" data-row-no="${e}">\n            <input type="hidden" name="row_no[]" value="${e}">\n            <input type="hidden" class="sorting_no" name="custom_sorting_no[]" value="${e}">\n                <td class="pl-1"><input id="item_name_${e}" name="custom_item_name[]" placeholder="Item Name" type="text" class="inputDescription form-control custom-item"></td>\n                <td class="itemHSN"><input name="custom_item_hsn[]" class="inputHSN form-control text-center" type="text" placeholder="HSN"></td>\n                <td class="itemQty"><input name="custom_item_qty[]" id="custom_item_qty_${e}" class="inputQty form-control text-center positive-float-number" type="text" value="1"></td>\n                <td class="itemPrice"><input id="item_price_${e}" name="custom_item_price[]" class="inputPrice form-control text-center positive-float-number" type="text" value="0"></td>\n                <td class="itemDiscount"><input name="custom_item_discount[]" id="custom_item_discount_${e}" class="inputDiscount form-control text-center positive-float-number" type="text" placeholder="0.00">\n                </td>\n                <td class="itemDiscount">\n                    <input type="hidden" class="indivisualDiscount" value="0">\n                    <select name="custom_item_discount_type[]" class="inputDiscountType form-control js-example-basic-single2">\n                        <option value="%">&nbsp;% &nbsp;</option>\n                        <option value="$">Flat</option>\n                    </select>\n                </td>\n\n                <td class="itemTax"><input type="hidden" class="indivisualTax" value="0">${o}</td>\n                <td class="itemAmount"><span class="currencySymbol"></span><span class="indivisualTotal">0</span>\n                </td>\n                <td class="text-center"><button type="button" class="closeRow btn btn-xs btn-danger" data-row-id="${e}"><i class="feather icon-trash-2"></i></button></td>\n            </tr>\n            <tr>\n                <td colspan="4" class="des-col">\n                    <textarea name="custom_item_description[]" placeholder="Item Description" class="inputItemDescription form-control"></textarea>\n                </td>\n              <td colspan="3" class="des-col"></td>\n            </tr>\n            </tbody>`;$(".addRowContainer").attr("id",e),$(".addRow").attr("data-row-no",e),$("#product-table").append(u),triggerSomeChanges(),resetEverythingExcept(),onChangeInvType(),generateSortingNumber(),$(".js-example-basic-single2").select2()}function onChangeInvType(){$(".itemQty").show();var t=$("#inv-type").val();"hours"==t?($(".hourTh").show(),$(".hourPriceTh").show(),$(".searchItemTh").text(jsLang("Service")),$(".itemName").text(jsLang("Services")),$(".addRow").text(jsLang("Add custom service"))):"amount"==t?($(".itemQty").hide(),$(".itemAmount").hide(),$(".itemPrice").show(),$(".amountTh").show()):($(".qtyTh").show(),$(".qtyPriceTh").show(),$(".searchItemTh").text(jsLang("Item")),$(".itemName").text(jsLang("Items")),$(".addRow").text(jsLang("Add custom item"))),$(".inputPrice").trigger("keyup")}function resetEverything(){$(".itemQty").hide(),$(".qtyTh").hide(),$(".hourTh").hide(),$(".itemDiscount").hide(),$(".itemTax").hide(),$(".qtyPriceTh").hide(),$(".hourPriceTh").hide(),$(".amountTh").hide(),$(".itemAmount").show()}function resetEverythingExcept(){$(".itemQty").hide(),$(".qtyTh").hide(),$(".hourTh").hide(),$(".qtyPriceTh").hide(),$(".hourPriceTh").hide(),$(".amountTh").hide(),$(".itemAmount").show()}function triggerAllChanges(){$("#inv-type").trigger("change"),$("#invItemTax").trigger("change"),$("#invItemDiscount").trigger("change"),$("#invItemDetails").trigger("change"),$("#invItemHSN").trigger("change"),$("#invOtherDiscount").trigger("change"),$("#invShipping").trigger("change"),$("#invCustomAmount").trigger("change"),$("#inv-currency").trigger("change"),$("#inputOtherDiscount").trigger("change"),$("#inputShipping").trigger("keyup"),$("#inputCustomAmount").trigger("keyup"),onChangeInvType()}function triggerSomeChanges(){$("#invItemTax").trigger("change"),$("#invItemDiscount").trigger("change"),$("#invItemDetails").trigger("change"),$("#invItemHSN").trigger("change"),$("#invOtherDiscount").trigger("change"),$("#invShipping").trigger("change"),$("#invCustomAmount").trigger("change"),$("#inv-currency").trigger("change"),$("#inputOtherDiscount").trigger("change")}function resetCurrencySymbol(){$("#subTotal").text(decimalNumberFormatWithCurrency(0)),$("#taxTotal").text(decimalNumberFormatWithCurrency(0)),$("#itemDiscountTotal").text(decimalNumberFormatWithCurrency(0)),$("#otherDiscountTotal").text(decimalNumberFormatWithCurrency(0)),$("#shippingTotal").text(decimalNumberFormatWithCurrency(0)),$("#customAmountTotal").text(decimalNumberFormatWithCurrency(0)),$("#grandTotal").text(decimalNumberFormatWithCurrency(0))}function calculateTotalQuantity(){var t=0;return $(".inputQty").each(function(e,i){t+=parseFloat(validateNumbers($(i).val()))}),t}function calculateTotalPrice(){var t=0;return $(".inputPrice").each(function(e,i){var a=parseFloat(validateNumbers($(this).parent().parent().find(".inputQty").val())),n=parseFloat(validateNumbers($(this).parent().parent().find(".inputDiscount").val())),r=$(this).parent().parent().find(".inputDiscountType").val(),o=0;$("#invItem-Discount").val();"on"==$("#invItem-Discount").val()&&(o="$"==r?n:a*parseFloat(validateNumbers(i.value))*n/100),t+=a*parseFloat(validateNumbers(i.value))-o}),$("#indivisual-discount-price").val(t),t}function calculateIndivisualTotalTax(){var t=0;return $(".itemTaxAmount").each(function(e,i){t+=parseFloat(validateNumbers($(i).val()))}),isNaN(t)&&(t=0),t}function calculateIndivisualTotalAmount(){var t=0;return $(".indivisualTotal").each(function(e,i){$(i).text();validateNumbers($(i).text()),t+=parseFloat(validateNumbers($(i).text()))}),isNaN(t)&&(t=0),t}function calculateIndivisualTotalDiscount(){var t=0;return $(".indivisualDiscount").each(function(e,i){t+=parseFloat(validateNumbers($(i).val()))}),isNaN(t)&&(t=0),t}function calculateHiddenDiscount(t){var e=t.parent().parent().find(".inputDiscountType").val(),i=validateNumbers(t.parent().parent().find(".inputDiscount").val());(isNaN(i)||""==i)&&(i=0);var a=validateNumbers(t.parent().parent().find(".inputQty").val())*validateNumbers(t.parent().parent().find(".inputPrice").val());$("#discount-on");$("#invItemDiscount").is(":checked")&&"%"==e&&(i=a*i/100),t.parent().parent().find(".indivisualDiscount").val(getDecimalNumberFormat(i))}function calculateHiddenTax(t){var e=0,i=validateNumbers(t.parent().parent().find(".inputQty").val())*validateNumbers(t.parent().parent().find(".inputPrice").val()),a=t.parent().parent().find(".inputDiscountType").val(),n=parseFloat(validateNumbers(t.parent().parent().find(".inputDiscount").val())),r=calculateTotalPrice();(isNaN(n)||""==n)&&(n=0),t.parent().parent().find(".inputTax option").each(function(){t.parent().parent().parent().find(".itemTaxAmount-"+$(this).val()).val("")}),t.parent().parent().find(".inputTax :selected").each(function(){e+=parseFloat(validateNumbers($(this).attr("taxrate")))});var o=0,u=0;u="$"==a?n:i*n/100;var s=$("#otherDiscountType").val(),c=validateNumbers($("#inputOtherDiscount").val());if(isNaN(c)||""==c)var l=0;else if("$"==s)l=c*(i-u)/r;else l=(i-u)*c/100;if("after"==$("#discount_on").val()){var m=i-u-l;"exclusive"==$("#tax-type").val()?o=m*e/100:"inclusive"==$("#tax-type").val()&&(o=m-m/(e/100+1))}else"before"==$("#discount_on").val()&&("exclusive"==$("#tax-type").val()?o=i*e/100:"inclusive"==$("#tax-type").val()&&(o=i-i/(e/100+1)));isNaN(o)&&(o=0),t.parent().parent().find(".indivisualTax").val(getDecimalNumberFormat(o)),t.parent().parent().find(".inputTax :selected").each(function(){if("after"==$("#discount_on").val()){var e=i-u-l;if("exclusive"==$("#tax-type").val())var a=e*parseFloat(validateNumbers($(this).attr("taxrate")))/100;else if("inclusive"==$("#tax-type").val())a=e-e/(parseFloat(validateNumbers($(this).attr("taxrate")))/100+1)}else if("before"==$("#discount_on").val())if("exclusive"==$("#tax-type").val())a=i*parseFloat(validateNumbers($(this).attr("taxrate")))/100;else if("inclusive"==$("#tax-type").val())a=i-i/(parseFloat(validateNumbers($(this).attr("taxrate")))/100+1);t.parent().parent().parent().find(".itemTaxAmount-"+$(this).val()).val(getDecimalNumberFormat(a))})}function generateSeparatedTaxAmount(){$.each(window.taxes,function(t,e){var i=0;$.each($(".itemTaxAmount-"+e.id),function(t,e){var a=""==validateNumbers($(this).val())?0:$(this).val();i+=parseFloat(validateNumbers(a))}),$("#taxTotalValue-"+e.id).text(decimalNumberFormatWithCurrency(i))})}function generateSortingNumber(){$.each($(".sorting_no"),function(t,e){$(this).val(++t)})}function generateOtherDiscount(){var t=$("#otherDiscountType").val(),e=validateNumbers($("#inputOtherDiscount").val());(isNaN(e)||""==e)&&(e=0);var i=0;$.each($(".indivisualDiscount"),function(t,e){i+=parseFloat(validateNumbers(e.value))});var a=parseFloat(validateNumbers($("#subTotal").text()));if("$"==t)var n=e;else n=(a-i)*e/100;""==n&&(n=0),$("#otherDiscountTotal").text(decimalNumberFormatWithCurrency(n))}function generateAllTotal(){generateOtherDiscount();var t=calculateIndivisualTotalAmount(),e=calculateIndivisualTotalTax(),i=calculateIndivisualTotalDiscount(),a=parseFloat(validateNumbers($("#otherDiscountTotal").text())),n=parseFloat(validateNumbers($("#shippingTotal").text())),r=parseFloat(validateNumbers($("#customAmountTotal").text()));if(generateSeparatedTaxAmount(),$("#subTotal").text(decimalNumberFormatWithCurrency(t)),$("#taxTotal").text(decimalNumberFormatWithCurrency(e)),$("#itemDiscountTotal").text(decimalNumberFormatWithCurrency(i)),"exclusive"==$("#tax-type").val()){var o=t+e-i-a+n+r;$("#grandTotal").text(decimalNumberFormatWithCurrency(parseFloat(o))),$("#grandTotalInput").val(decimalNumberFormatWithCurrency(parseFloat(o))),$("#totalValue").val(getDecimalNumberFormat(parseFloat(o)))}else{o=t-i-a+n+r;$("#grandTotal").text(decimalNumberFormatWithCurrency(parseFloat(o))),$("#grandTotalInput").val(decimalNumberFormatWithCurrency(parseFloat(o))),$("#totalValue").val(getDecimalNumberFormat(parseFloat(o)))}$(".selectpicker").selectpicker()}function setModalFieldsValue(){$("#discount_on").val($("#discount-on").val()),$("#tax_type").val($("#tax-type").val()),$("#sales_type").val($("#sales_type_id").val()),isChecked("#invItemTax","#invItem-Tax"),isChecked("#invItemDetails","#invItem-Details"),isChecked("#invItemDiscount","#invItem-Discount"),isChecked("#invItemHSN","#invItem-hsn"),isChecked("#invOtherDiscount","#inv-other-discount"),isChecked("#invShipping","#inv-shipping"),isChecked("#invCustomAmount","#inv-custom-amount")}function isChecked(t,e){$(t).is(":checked")?$(e).val("on"):$(e).val("")}$(document).on("change","#otherDiscountType",function(){if("%"==$(this).val())prevOtherDiscountAmount=100;else{var t=$("#subTotal").text();prevOtherDiscountAmount=getDecimalNumberFormat(validateNumbers(t))}$("#inputOtherDiscount").trigger("change")}),$("#inputOtherDiscount").on("change",function(){var t=!0,e=$("#otherDiscountType").val(),i=parseFloat(validateNumbers($("#inputOtherDiscount").val()));if("%"==e&&i>100)t=!1,swal("Discount amount can't be more than 100%",{icon:"error"});else if("$"==e){var a=$("#subTotal").text();i>parseFloat(validateNumbers(a))&&(t=!1,swal("Discount amount can't be more than "+a,{icon:"error"}))}t?prevOtherDiscountAmount=$(this).val():(prevOtherDiscountAmount>parseFloat(validateNumbers($("#subTotal").text()))&&(prevOtherDiscountAmount=parseFloat(validateNumbers($("#subTotal").text()))),$(this).val(prevOtherDiscountAmount)),$(".inputPrice").trigger("keyup")}),$("#inputShipping").on("keyup",function(){var t=""==$(this).val()?0:validateNumbers($(this).val());$("#shippingTotal").text(decimalNumberFormatWithCurrency(t)),$(".inputPrice").trigger("keyup")}),$("#inputCustomAmount").on("keyup",function(){var t=""==$(this).val()?0:validateNumbers($(this).val());$("#customAmountTotal").text(decimalNumberFormatWithCurrency(t)),$(".inputPrice").trigger("keyup")}),$(document).on("click",".closeRow",function(){if("false"==$(this).attr("data-deletable")){var t=$(this).attr("data-alert");swal(t,{icon:"error"})}else{var e=$(this).attr("data-row-id"),i=$(".rowNo-"+e).attr("id");if(i){var a=i.split("-")[1];stack.indexOf(parseInt(a))}$(".closeRow").length;$("#rowId-"+e).remove(),generateAllTotal(),generateOtherDiscount(),$(".itemRow").length<1&&$(".taxRow").css("display","none"),$(".inputPrice").trigger("keyup"),$(".inputTax").trigger("change"),generateSortingNumber(),$(".custom-item").length<1&&("hours"==$("#inv-type").val()?$(".addRow").text(jsLang("Add custom service")):$(".addRow").text(jsLang("Add custom item")))}});
