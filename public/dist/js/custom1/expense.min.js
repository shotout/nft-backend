"use strict";function numberRound(e){return parseFloat(e).toFixed(2)}if($(".select").select2(),$(".main-body .page-wrapper").find("#add-expense-container").length){var DefaultCurrency=defaultCurrencyID;function readURL(e){if(e.files&&e.files[0]){var a=new FileReader;$("#prvw").removeAttr("hidden"),$("#imgAnchor").removeAttr("hidden"),$("#divNote").hide(),a.onload=function(e){$("#blah").attr("src",e.target.result),$("#imgAnchor").attr("href",e.target.result),$("#imgAnchor").attr("data-toggle","lightbox")},a.readAsDataURL(e.files[0])}}$("#trans_date").daterangepicker(dateSingleConfig()),$("#exchange_rate").on("keyup",function(){$("#valueText").html($("#exchange_rate").val())}),$("#validatedCustomFile").on("change",function(){$(this).next(".custom-file-label").html($(this)[0].files[0].name)}),$("#expense").validate({rules:{trans_date:{required:!0},account_no:{required:!0},category_id:{required:!0},amount:{required:!0},currency:{required:!0},attachment:{fileType:"jpg|png|gif|doc|docx|pdf",remote:function(e){if(0!=e.files.length)return{url:SITE_URL+"/is-valid-file-size",data:{filesize:e.files[0].size}}}}},messages:{amount:{number:jsLang("Enter a valid amount!"),min:jsLang("Enter a valid amount!")}},submitHandler:function(){var e=$("#amount").val(),a=$("#totalBalance").val(),t=$("#payment_method").val();if("Bank"==t&&parseFloat(a)>=parseFloat(e)||"Bank"!=t)return!0}}),$(document).on("click","#btnSubmit",function(){1==$("#expense").valid()&&($(".spinner").show(),$(".spinner").css("line-height","0"),$(".spinner").css("display","inline-block"),$("#spinnerText").text(jsLang("Please wait...")),$(this).attr("disabled","disabled"),$("#expense").trigger("submit"))}),$("input").on("keyup",function(){$(this).valid()}),$(document).on("keyup","#amount",function(e){var a=$(this).val(),t=$("#payment_method :selected").val(),n=($("#token").val(),$("#account_no").val(),$("#amount").val()),r=($("#homeCurrency").val(),$("#totalBalance").val());"Bank"==t?(parseFloat(a)>parseFloat(r)&&""!=n&&$("#errorMessage").html('<span class="f-11">'+jsLang("Insufficient Balance")+"<span>").show(),(parseFloat(a)<=parseFloat(r)||""==n)&&$("#errorMessage").html("")):($("#currency-div").show(),$("#currency").trigger("change"))}),$(document).on("change","#payment_method",function(){$("#errorMessage").hide("");var e=$(this).val(),a=($("#homeCurrency").val(),$("option:selected",this).attr("data-methodId"));$("#payment_method_id").val(a);$("#account_no").val();"Bank"==e?($("#account").css("display","flex"),$("#currency-div").hide()):($("#account_no").val(""),$("#account_no").trigger("change"),$("#account").css("display","none"),$("#currency").attr("disabled",!1),$("#currency-div").show())}),$("#account_no").on("change",function(){var e=$("#amount").val();$("#account_no-error").hide();let a=$(this).val(),t=$("option:selected",this).attr("currency-id"),n=$("option:selected",this).attr("currency-code");var r=$("#payment_method :selected").val();let s=$("#trans_date").val();var o=SITE_URL+"/get/balance";""!=a?$.ajax({url:o,method:"POST",data:{account_no:a,currency_id:t,date:s,_token:token},dataType:"json",success:function(a){$(".message").removeClass("text-danger").addClass("text-success").html("<strong>"+jsLang("Current Balance")+": "+getDecimalNumberFormat(numberRound(a.balance))+" "+n+"</strong>"),"Bank"==r?($("#currency-div").show(),$("#currency").val(t).trigger("change").attr("disabled",!0),parseFloat(e)>parseFloat(a.balance)&&$("#errorMessage").html('<span class="f-11">'+jsLang("Insufficient Balance")+"<span>").show(),(parseFloat(e)<=parseFloat(a.balance)||""==e)&&$("#errorMessage").html("")):$("#errorMessage").html(""),$("#currency_id").val(t),$("#totalBalance").val(a.balance)}}):$(".message").html("")}),$("input").on("keyup change",function(){$(this).valid()}),$(document).on("change",".category",function(e){""!=$(e.currentTarget).val()?$("#category_id-error").hide():$("#category_id-error").show()})}if($(".main-body .page-wrapper").find("#edit-expense-container").length){var method=paymentMethod;function readURL(e){if(e.files&&e.files[0]){var a=new FileReader;$("#prvw").removeAttr("hidden"),$("#imgAnchor").removeAttr("hidden"),$("#divNote").hide(),a.onload=function(e){$("#blah").attr("src",e.target.result),$("#imgAnchor").attr("href",e.target.result),$("#imgAnchor").attr("data-toggle","lightbox")},a.readAsDataURL(e.files[0])}}"Bank"==method?($("#previousAccount").css("display","flex"),$("#currency").attr("disabled",!0)):($("#previousAccount").css("display","none"),$("#currency").attr("disabled",!1)),$("#validatedCustomFile").on("change",function(){$(this).next(".custom-file-label").html($(this)[0].files[0].name)}),$("#expense").validate({rules:{acc_no:{required:!0},trans_date:{required:!0},amount:{required:!0},category_id:{required:!0},currency:{required:!0},attachment:{fileType:"jpg|png|gif|doc|docx|pdf",remote:function(e){if(0!=e.files.length)return{url:SITE_URL+"/is-valid-file-size",data:{filesize:e.files[0].size}}}}},messages:{amount:{number:jsLang("Enter a valid amount!"),min:jsLang("Enter a valid amount!")}},submitHandler:function(){var e=$("#amount").val(),a=$("#payment_method :selected").val(),t=$("#totalBalance").val();if(t=validateNumbers(t),"Bank"==a&&parseFloat(t)>=parseFloat(e)||"Bank"!=a)return!0}}),$(document).on("click","#btnSubmit",function(){1==$("#expense").valid()&&($(".spinner").show(),$(".spinner").css("line-height","0"),$(".spinner").css("display","inline-block"),$("#spinnerText").text(jsLang("Please wait...")),$(this).attr("disabled","disabled"),$("#expense").trigger("submit"))}),$("#account_number").on("change",function(){var e=$("#amount").val();$("#account_no-error").hide();let a=$(this).val(),t=$("option:selected",this).attr("currency-id"),n=$("option:selected",this).attr("currency-code");var r=$("#payment_method :selected").val();let s=$("#trans_date").val();var o=SITE_URL+"/get/balance";""!=a?$.ajax({url:o,method:"POST",data:{account_no:a,currency_id:t,date:s,_token:token},dataType:"json",success:function(a){$(".message").removeClass("text-danger").addClass("text-success").html("<strong>Current Balance: "+getDecimalNumberFormat(a.balance)+" "+n+"</strong>"),"Bank"==r?($("#currency-div").show(),$("#currency").val(t).trigger("change").attr("disabled",!0),parseFloat(e)>parseFloat(a.balance)&&$("#errorMessage").html(jsLang("Insufficient Balance")).show(),(parseFloat(e)<=parseFloat(a.balance)||""==e)&&$("#errorMessage").html("")):$("#errorMessage").html(""),$("#currency_id").val(t),$("#totalBalance").val(a.balance)}}):$(".message").html("")}),$("#acc_no").on("change",function(){$("#currency-div").show();var e=$("#amount").val();$("#acc_no-error").hide();let a=$(this).val(),t=$("option:selected",this).attr("currency-id"),n=$("option:selected",this).attr("currency-code");var r='<option selected value="'+t+'">'+n+"</option>",s=$("#payment_method :selected").val();let o=$("#trans_date").val();var l=SITE_URL+"/get/balance";""!=a?$.ajax({url:l,method:"POST",data:{account_no:a,currency_id:t,date:o,_token:token},dataType:"json",success:function(a){$(".message").removeClass("text-danger").addClass("text-success").html("<strong>Current Balance: "+getDecimalNumberFormat(a.balance)+" "+n+"</strong>"),"Bank"==s?($("#currency-div").show(),$("#currency").append(r).attr("disabled",!0),parseFloat(e)>parseFloat(a.balance)&&$("#errorMessage").html('<span class="f-11">'+jsLang("Insufficient Balance")+"<span>").show(),(parseFloat(e)<=parseFloat(a.balance)||""==e)&&$("#errorMessage").html("")):$("#errorMessage").html(""),$("#currency_id").val(t),$("#totalBalance").val(a.balance)}}):$(".message").html("")}),$("#account_number").trigger("change"),$("#acc_no").trigger("change"),$(document).on("change","#payment_method",function(){$("#errorMessage").hide("");var e=$(this).val(),a=($("#homeCurrency").val(),$("option:selected",this).attr("data-methodId"));$("#payment_method_id").val(a),"Bank"==e?($("#account").css("display","flex"),$("#currency-div").hide(),$("#currency").attr("disabled",!0),$("#account_no").trigger("change"),$("#acc_no").trigger("change")):($("#account_no").val(""),$("#account_no").trigger("change"),$("#acc_no").val(""),$("#acc_no").trigger("change"),$("#account").css("display","none"),$("#previousAccount").css("display","none"),$("#currency").attr("disabled",!1),$("#currency-div").show())}),$(document).on("keyup","#amount",function(e){var a=$(this).val(),t=$("#payment_method :selected").val(),n=($("#token").val(),$("#homeCurrency").val(),$("#totalBalance").val());"Bank"==t?""!=n?(parseFloat(a)>parseFloat(n)&&""!=a&&$("#errorMessage").html('<span class="f-11">'+jsLang("Insufficient Balance")+"<span>").show(),(parseFloat(a)<=parseFloat(n)||""==a)&&$("#errorMessage").html("")):(parseFloat(a)>parseFloat(balanceBank)&&""!=a&&$("#errorMessage").html('<span class="f-11">'+jsLang("Insufficient Balance")+"<span>").show(),(parseFloat(a)<=parseFloat(balanceBank)||""==a)&&$("#errorMessage").html("")):($("#currency-div").show(),$("#currency").trigger("change"))}),$(".attachment-delete").on("click",function(){swal({title:jsLang("Are you sure?"),text:jsLang("Once deleted, you will not be able to recover this file."),icon:"warning",buttons:[jsLang("Cancel"),jsLang("Ok")],dangerMode:!0}).then(e=>{if(e){var a=$(this),t=(a.parent(),$(".attachment").parent()),n=$(".attachment-delete").parent();$.ajax({type:"POST",url:SITE_URL+"/file/remove",data:{id:a.attr("data-attachment"),filePath:"public/uploads/expense",_token:token},dataType:"json",success:function(e){1==e.status?(t.remove(),n.remove(),swal(jsLang("Success! Your file has been deleted."),{icon:"success"})):swal(jsLang("Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})}})}),$("#theModal").on("show.bs.modal",function(e){var a=$(e.relatedTarget),t=$(this);$("#theModalSubmitBtn").attr("data-task","").removeClass("delete-task-btn"),"Delete"==a.data("label")?(t.find("#theModalSubmitBtn").addClass("delete-task-btn").attr("data-task",a.data("id")).text(jsLang("Delete")).show(),t.find("#theModalLabel").text(a.data("title")),t.find(".modal-body").text(a.data("message"))):t.find(".modal-body").load(a.data("remote"))})}$(".main-body .page-wrapper").find(".list-container").length&&($("body").tooltip({selector:'[data-toggle="tooltip"]'}),$(document).on("click","#csv, #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/expense_list_"+this.id+"?to="+$("#endto").val()+"&from="+$("#startfrom").val()+"&categoryName="+$("#categoryName").val()+"&methodName="+$("#methodName").val()}),$("#dataTableBuilder").addClass("expense-list"));