"use strict";let global_exchangeRate;function editPurchaseReceive(e){$("#submit-button").on("click",function(){$.ajax({type:"POST",url:$("#editReceive").attr("action"),data:{_token:token,id:$("#receive-id").val(),date:$("#date").val()},beforeSend:function(){"list"==e&&$("#submit-button").html(spinner)},success:function(e){return 1==e.status?($("#editModal").modal("toggle"),$("#dataTableBuilder").DataTable().ajax.reload(null,!1)):$("#error-msg").css("display","flex").text(jsLang("Update failed, please try again.")),!1},error:function(e){swal(jsLang("Oops! Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})})}if(($(".main-body .page-wrapper").find("#sales-quotation-view-details-container").length||$(".main-body .page-wrapper").find("#sales-invoice-view-details-container").length||$(".main-body .page-wrapper").find("#purchase-view-details-container").length)&&(jQuery.validator.addMethod("regxEmailValidation",function(e,t){return this.optional(t)||validateEmail(e)},jsLang("Enter a valid email")),$("#sendOrderInfo").validate({rules:{email:{required:!0,regxEmailValidation:!0},subject:{required:!0},message:{required:!0}}}),($(".main-body .page-wrapper").find("#sales-quotation-view-details-container").length||$(".main-body .page-wrapper").find("#sales-invoice-view-details-container").length)&&$("#sendOrderInfoSMS").validate({rules:{phoneno:{required:!0},message:{required:!0}}})),$(document).on("change","#inv-exchange-rate",function(){var e=parseFloat(validateNumbers($("#inv-exchange-rate").val()));""!=global_exchangeRate&&null!=global_exchangeRate&&"undefined"!==global_exchangeRate||(global_exchangeRate=$("#global_exchangeRate").val()),$.each($(".inputPrice"),function(t,n){var a=validateNumbers(n.value)/global_exchangeRate*e;$(n).val(getDecimalNumberFormat(a))}),global_exchangeRate=e,$(".inputPrice").trigger("keyup")}),$(".main-body .page-wrapper").find("#purchase-list-container").length&&($(document).on("click","#csv, #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/purchase-"+this.id+"?to="+$("#endto").val()+"&from="+$("#startfrom").val()+"&supplier="+$("#supplier").val()+"&currency="+$("#currency").val()+"&location="+$("#location").val()+"&status="+$("#status").val()}),$("#dataTableBuilder").addClass("purchase-list")),$(".main-body .page-wrapper").find("#purchase-add-container").length){var stack=[],nums=[],symbol="",defaultCurrencySymbol=currencySymbol,refNo="PO-"+$("#reference_no").val();$("#reference_no_write").val(refNo),$(".select2").select2(),setModalFieldsValue(),resetEverything(),triggerAllChanges(),generateAllTotal(),$(".inputPrice").trigger("keyup"),generateSortingNumber(),$(".addRowContainer").hide().last().show(),$("#myModal").on("show.bs.modal",function(){$("#myModal .select2-container--default").not(":first").remove(),$(".js-example-basic-single2").select2({dropdownParent:$("#myModal-body")})}),customerOrSupplierModal("btn_add_supplier","add-supplier",jsLang("Add Supplier")),submitCustomerOrSupplierModal("btn_add_supplier","#addSupplier"),$("#btnSubmit").on("click",function(){return checkItemSelected(jsLang("Please select at least one item to create purchase."))}),$("#purchaseForm").validate({rules:{supplier_id:{required:!0},order_date:{required:!0},reference:{required:!0},"item_qty[]":{required:!0},"custom_item_qty[]":{required:!0},"item_price[]":{required:!0},"custom_item_price[]":{required:!0},"item_name[]":{required:!0},"custom_item_name[]":{required:!0},inv_exchange_rate:{required:!0},custom_amount_title:{required:!0}},messages:{order_date:{required:jsLang("Order date required")},reference:{required:jsLang("Reference required")},"item_name[]":{required:jsLang("Required")},"custom_item_name[]":{required:jsLang("Required")},"item_qty[]":{required:jsLang("Required")},"custom_item_qty[]":{required:jsLang("Required")},"item_price[]":{required:jsLang("Required")},"custom_item_price[]":{required:jsLang("Required")},custom_amount_title:{required:jsLang("Required")}}}),customItemValidation("#purchaseForm"),hideNoDiv(),referenceNo("PO-",SITE_URL+"/purchase/reference-validation"),customItem("add","#supplier",jsLang("Please select supplier first")),onChangeLocation(),$("#supplier").on("change",function(){onChangeSupplierOrCustomer("#supplier")}),showExchangeRate("#supplier"),$(".inputDiscountType").select2(),$("#datepicker").daterangepicker(dateSingleConfig()),$("#search").autocomplete({delay:500,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(e,t){autoCompleteSource(e,t,SITE_URL+"/purchase/item-search","#supplier")},select:function(e,t){var n=t.item;if(n.id){if(in_array(n.id,stack)){var a=$("#itemId-"+n.id).find(".inputQty").val();a=validateNumbers(a),a++,$("#itemId-"+n.id).find(".inputQty").val(getDecimalNumberFormat(a))}else{autoCompleteSelect("add",n,"#supplier");var i=`<tbody id="rowId-${rowNo}">\n                          <input type="hidden" name="item_id[]" value="${n.id}">\n                          <input type="hidden" class="sorting_no" name="sorting_no[]" value="${rowNo}">\n                          <tr class="itemRow rowNo-${rowNo}" id="itemId-${n.id}"  data-row-no="${rowNo}">\n                              <td class="pl-1">\n                                  <input id="item_name_${rowNo}" name="item_name[]" placeholder="${jsLang("Item Name")}" value="${n.value}" type="text" class="inputDescription form-control">\n                              </td>\n                              <td class="itemHSN">\n                                  <input name="item_hsn[]" class="inputHSN form-control text-center" id="item_hsn_${rowNo}" type="text" placeholder="${jsLang("HSN")}" value="${n.hsn}">\n                              </td>\n                              <td class="itemQty">\n                                  <input name="item_qty[]" id="item_qty_${rowNo}" class="inputQty form-control text-center positive-float-number" type="text" value="1">\n                              </td>\n                              <td class="itemPrice">\n                                <input id="item_price_${rowNo}" name="item_price[]" value="${getDecimalNumberFormat(n.price)}" class="inputPrice form-control text-center positive-float-number" type="text" placeholder="0.00">\n                              </td>\n                              <td class="itemDiscount">\n                                <input name="item_discount[]" id="item_discount_${rowNo}" class="inputDiscount form-control text-center positive-float-number" type="text" placeholder="0.00">\n                              </td>\n                              <td class="itemDiscount">\n                                  <input type="hidden" class="indivisualDiscount" value="0">\n                                  <select name="item_discount_type[]" class="inputDiscountType select2 form-control">\n                                      <option value="%">&nbsp;% &nbsp;</option>\n                                      <option value="$">Flat</option>\n                                  </select>\n                              </td>\n                              <td class="itemTax min-width-145">\n                                  <input  type="hidden" class="indivisualTax" value="0">${taxSelect}\n                              </td>\n                              <td class="itemAmount">\n                                  <span class="indivisualTotal">0</span>\n                              </td>\n                              <td class="text-center">\n                                  <button type="button" class="closeRow btn btn-xs btn-danger" data-row-id="${rowNo}"><i class="feather icon-trash-2"></i></button>\n                              </td>\n                          </tr>\n                          <tr id="des-row-${rowNo}">\n                              <td colspan="${rowNo}" class="des-col">\n                                  <textarea name="item_description[]" placeholder="${jsLang("Item Description")}" class="inputItemDescription form-control">${null==n.description||""==n.description?"":n.description}</textarea>\n                              </td>\n                              <td colspan="3" class="des-col"></td>\n                          </tr>\n                      </tbody>`;$("#product-table").append(i),onChangeTax(".inputTax")}return $("#itemId-"+n.id).find(".inputQty").trigger("blur"),resetEverythingExcept(),onChangeInvType(),generateSortingNumber(),triggerSomeChanges(),$(".select2").select2(),checkStack(rowNo,"purchase_add"),this.value="",!1}},minLength:1,autoFocus:!0}),$(".selectpicker").selectpicker(),$(document).on("change",".inputTax",function(){onChangeTax(".inputTax")}),allTax(".inputTax.form-control",".inputTax"),calculateHiddenTax($(this)),$("#otherDiscountType").trigger("change"),generateAllTotal(),deleteAttachment(SITE_URL+"/file/remove"),uploadAttachment(SITE_URL+"/file/upload","#supplier"),$(document).on("click","#btnSubmit",function(){return 0!=checkDiscountAmount()&&(0!=checkIsAvailable("invoice")&&void(1==$("#purchaseForm").valid()&&($(".spinner").show(),$(".spinner").css("line-height","0"),$(".spinner").css("display","inline-block"),$("#spinnerText").text(jsLang("Please wait...")),$(this).attr("disabled","disabled"),$("#purchaseForm").trigger("submit"))))})}if($(".main-body .page-wrapper").find("#purchase-edit-container").length){nums=[];if(global_exchangeRate=exchangeVal.toFixed(decimal_digits),resetEverything(),onChangeInvType(),$("#invItemTax, #invItemDiscount, #invItemDetails, #invItemHSN, #invShipping, #invCustomAmount, #invOtherDiscount, #discount-on, #tax-type").trigger("change"),setModalFieldsValue(),generateAllTotal(),hideNoDiv(),$(".inputPrice").trigger("keyup"),generateSortingNumber(),$(".addRowContainer").hide().last().show(),$("#myModal").on("show.bs.modal",function(){$("#myModal .select2-container--default").not(":first").remove(),$(".js-example-basic-single").select2({dropdownParent:$("#myModal-body")})}),$("#btnSubmit").on("click",function(){return checkItemSelected(jsLang("Please select at least one item to purchase"))}),$("#purchaseForm").validate({rules:{supplier_id:{required:!0},order_date:"required",reference:"required","custom_item_name[]":{required:!0},"item_name[]":{required:!0},"old_item_name[]":{required:!0},"item_qty[]":{required:!0},"old_item_qty[]":{required:!0},"custom_item_qty[]":{required:!0},"item_price[]":{required:!0},"old_item_price[]":{required:!0},"custom_item_price[]":{required:!0},inv_exchange_rate:{required:!0},custom_amount_title:{required:!0},shipping:{required:!0},custom_amount:{required:!0}},messages:{order_date:{required:jsLang("Order date required")},"old_item_name[]":{required:jsLang("Required")},"item_name[]":{required:jsLang("Required")},"custom_item_name[]":{required:jsLang("Required")},"item_qty[]":{required:jsLang("Required")},"old_item_qty[]":{required:jsLang("Required")},"custom_item_qty[]":{required:jsLang("Required")},"item_price[]":{required:jsLang("Required")},"old_item_price[]":{required:jsLang("Required")},"custom_item_price[]":{required:jsLang("Required")},custom_amount_title:{required:jsLang("Required")},shipping:{required:jsLang("Required")},custom_amount:{required:jsLang("Required")}}}),$(document).on("click",".addRow",function(){changeCustomItemText()}),exchangeRateValue(exchangeVal,"#inv-exchange-rate"),onChangeLocation(),$(".select2, .inputDiscountType").select2(),""!=$("#datepicker").val())var purchase_date=$("#datepicker").val();$("#datepicker").daterangepicker(dateSingleConfig($("#datepicker").val())),$("#search").autocomplete({delay:500,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(e,t){autoCompleteSource(e,t,SITE_URL+"/purchase/item-search","#supplier",$("#sales_type_id").val())},select:function(e,t){var n=t.item;if(n.id){if(in_array(n.id,stack)){var a=validateNumbers($("#itemId-"+n.id).find(".inputQty").val());a++,$("#itemId-"+n.id).find(".inputQty").val(getDecimalNumberFormat(a))}else{autoCompleteSelect("add",n,"#supplier");var i=`<tbody id="rowId-${rowNo}">\n                          <input type="hidden" name="item_id[]" value="${n.id}">\n                          <input type="hidden" class="sorting_no" name="sorting_no[]" value="${rowNo}">\n                          <tr class="itemRow rowNo-${rowNo}" id="itemId-${n.id}">\n                            <td class="pl-1">\n                              <input id="item_name_${rowNo}" name="item_name[]" placeholder="${jsLang("Item Name")}" value="${n.value}" type="text" class="inputDescription form-control">\n                            </td>\n                            <td class="itemHSN">\n                              <input name="item_hsn[]" class="inputHSN form-control text-center" type="text" placeholder="${jsLang("HSN")}" value="${n.hsn}">\n                            </td>\n                            <td class="itemQty">\n                              <input name="item_qty[]" class="inputQty form-control text-center positive-float-number" id="item_qty_${rowNo}" type="text" value="1" min="0">\n                            </td>\n                            <td class="itemPrice">\n                              <input id="item_price_${rowNo}" name="item_price[]" value="${getDecimalNumberFormat(n.price)}" class="inputPrice form-control text-center positive-float-number" type="text" placeholder="0.00" min="0">\n                            </td>\n                            <td class="itemDiscount">\n                              <input name="item_discount[]" id="item_discount_${rowNo}" class="inputDiscount form-control text-center positive-float-number" type="text" placeholder="0.00" min="0">\n                            </td>\n                            <td class="itemDiscount">\n                              <input type="hidden" class="indivisualDiscount" value="0">\n                              <select name="item_discount_type[]" class="inputDiscountType form-control">\n                                  <option value="%">%</option>\n                                  <option value="$">Flat</option>\n                              </select>\n                            </td>\n                            <td class="itemTax min-width-145">\n                              <input  type="hidden" class="indivisualTax" value="0">${taxSelect}\n                            </td>\n                            <td class="itemAmount">\n                              <span class="indivisualTotal">0</span>\n                            </td>\n                            <td class="text-center">\n                              <button type="button" class="closeRow btn btn-xs btn-danger" data-row-id="${rowNo}"><i class="feather icon-trash-2"></i></button>\n                            </td>\n                          </tr>\n                          <tr id="des-row-${rowNo}">\n                            <td colspan="4" class="des-col">\n                              <textarea name="item_description[]" placeholder="${jsLang("Item Description")}" class="inputItemDescription form-control"></textarea>\n                            </td>\n                            <td colspan="3" class="des-col"></td>\n                          </tr>\n                        </tbody>`;$("#product-table").append(i)}return triggerSomeChanges(),resetEverythingExcept(),onChangeInvType(),generateSortingNumber(),checkStack(rowNo),this.value="",!1}},minLength:1}),$(".selectpicker").selectpicker(),$(document).on("changed.bs.select",".selectpicker",function(e,t,n,a){onChangeTax(".selectpicker")}),allTax(".inputTax.form-control.selectpicker",".selectpicker"),deleteAttachment(SITE_URL+"/file/remove"),uploadAttachment(SITE_URL+"/file/upload","#supplier"),$(".inputQty").trigger("change"),$(document).on("click","#btnSubmit",function(){return 0!=checkDiscountAmount()&&(0!=checkIsAvailable("invoice")&&void 0)})}if($(".main-body .page-wrapper").find("#purchase-view-details-container").length){$(".spinner").css("display","none");var accountNo="",paymentMethod="",paymentMethodName="",currencyId="",currencyName="",currencyOption="";$("#payment_date").daterangepicker(dateSingleConfig()),$("#payModal").on("hidden.bs.modal",function(){$("#account_div").css("display","none"),payModal()}),$("#payModal").on("show.bs.modal",function(){$("#account_div").css("display","none"),$("#currency").val(invoiceCurrency).trigger("change")}),$(".js-example-basic").select2({dropdownParent:$("#payModal")}),ClassicEditor.create(document.querySelector(".editor")),$("#payForm").validate({rules:{amount:{required:!0},incoming_amount:{required:!1},payment_date:{required:!0},currency:{required:!0}},submitHandler:function(){payFormAjaxCall()}}),deleteModal(),$("#theModalSubmitBtn").on("click",function(){$("#delete-purchase").trigger("submit")}),$(document).on("change","#payment_method",function(){$("#account_currency_div").css("display","none"),onChangePaymentMethod("purchase")}),$("#currency").on("change",function(){onChangeCurrency(Number(dflt_currency_id),Number($("#currency").val()))}),$(document).on("keyup","#amount, #exchange_rate",function(){onKeyUpAmountExchangeRate()}),$("#account_no").on("change",function(){onChangeAccountNo("purchase")}),deleteAttachment(SITE_URL+"/file/remove?type=purchase"),uploadAttachment(SITE_URL+"/file/upload?type=payment","#customer_id"),$("#modalBtn").on("click",function(){$("#payModal").modal({backdrop:"static",keyboard:!1})})}if($(".main-body .page-wrapper").find("#purchase-receive-list-container").length&&($(document).on("click",".edit-btn",function(){$("#receive-id").val($(this).attr("data-id")),$("#date").val($(this).attr("data-date"))}),$(document).on("show.bs.modal","#editModal",function(){$("#date").daterangepicker(dateSingleConfig(),function(e,t){$("#date").val(moment(e,"MMMM D, YYYY").format(dateFormat))})}),editPurchaseReceive("list"),$(document).on("click","#csv, #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/purchase/receive/"+this.id+"?to="+$("#endto").val()+"&from="+$("#startfrom").val()+"&supplier="+$("#supplier").val()}),$("#dataTableBuilder").addClass("purchase-receive-list")),$(".main-body .page-wrapper").find("#purchase-recieve-details-container").length&&($("#date").daterangepicker(dateSingleConfig(editDate)),deleteModal(),$("#theModalSubmitBtn").on("click",function(){$("#delete-purchase-receive").trigger("submit")}),editPurchaseReceive("details")),$(".main-body .page-wrapper").find("#purchase-payment-list-container").length&&($(".select2").select2({}),$(document).on("click","#csv, #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/payment/supplier-"+this.id+"?to="+$("#endto").val()+"&from="+$("#startfrom").val()+"&supplier="+$("#supplier").val()+"&method="+$("#method").val()+"&currency="+$("#currency").val()}),$("#dataTableBuilder").addClass("purchase-payment-list")),$(".main-body .page-wrapper").find("#purchase-payment-edit-container").length&&($("#payment_date").attr("readonly","readonly"),deleteAttachment(SITE_URL+"/file/remove"),uploadAttachment(SITE_URL+"/file/upload","#customers"),$(window).on("load",function(){$(window).width()<650&&($(".col-sm-2").addClass("col-sm-3"),$(".col-sm-3").removeClass("col-sm-2"),$(".col-sm-7").addClass("col-sm-8"),$(".col-sm-8").removeClass("col-sm-7"))})),$(".main-body .page-wrapper").find("#purchase-payment-view-details-container").length&&(ClassicEditor.create(document.querySelector(".editor")),$("#sendPaymentReceipt").validate({rules:{email:{required:!0},subject:{required:!0},message:{required:!0}}}),deleteModal(),$("#theModalSubmitBtn").on("click",function(){$("#delete-purchase-payment").trigger("submit")})),$(".main-body .page-wrapper").find("#add-purchase-receive-container").length){let e,t,n;$("#datepicker").daterangepicker(dateSingleConfig()),$(document).on("click",".delete_item",function(e){e.preventDefault(),$(this).closest("tr").remove(),0==$("tr.tblRows").length&&$("#btnSubmit").prop("disabled",!0)}),$(".inputQty").on("keyup",function(){$(this).each(function(){e=$(this).attr("data-id"),n=$("#rowId-"+e).val(),t=$(this).attr("data-max"),$.isNumeric(n)?$.isNumeric(n)&&(""!=n&&parseFloat(validateNumbers(n))>parseFloat(t)?$("#error_"+e).addClass("errorClass").text(jsLang("Quantity can not be more than")+" "+getDecimalNumberFormat(t)).show():0==n||""==n?$("#error_"+e).addClass("errorClass").text(jsLang("Quantity can not be zero or empty")).show():$("#error_"+$(this).attr("data-id")).removeClass("errorClass").text("").hide()):""==n&&$("#error_"+e).addClass("errorClass").text(jsLang("Quantity can not be zero or empty")).show()})}),$(document).on("click",".delete_item",function(e){e.preventDefault(),$(this).closest("tr").remove()}),$("#btnSubmit").on("click",function(){return 0!=$("tr.tblRows").length&&!$(".spanClass").hasClass("errorClass")})}