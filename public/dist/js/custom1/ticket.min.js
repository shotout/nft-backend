"use strict";if($(".select2").select2(),$(".main-body .page-wrapper").find("#add-ticket-container").length){var theEditor;function selectedCustomer(){$("#assign_name").val($("#customer_id option:selected").attr("data-name")),$("#assign_email").val($("#customer_id option:selected").attr("data-email"))}$(document).on("change","#customer_id",function(){selectedCustomer()}),""!=projectId&&$("#project_id, #customer_id").prop("disabled",!0),$("body").on("click",".delete_file_field",function(){$(this).parents(".control-group").remove()}),validateCKEditor("#ticket_messages","#ticket_messages-error"),$("#add_ticket_form").validate({ignore:[],rules:{subject:{required:!0},project_id:{required:!0},assign_id:{required:!0},department_id:{required:!0},priority_id:{required:!0},customer_id:{required:function(t){return"yes"!=$("#flag").val()}},message:{CKEditorRequired:!0}}}),$("select").on("change",function(){""!=$(this).val()&&$(this).valid(),$("#project_id").on("change",function(){var t=$("#project_id").val();$.ajax({method:"get",url:SITE_URL+"/ticket/check-inhouse-project",data:{id:t}}).done(function(t){"yes"==t?($(".select-customer-div, .customer-info-div").hide(),$("#flag").val("yes")):($(".select-customer-div, .customer-info-div").show(),$("#flag").val("no"))})})}),deleteAttachment(SITE_URL+"/file/remove?type=ticket_reply"),uploadAttachment(SITE_URL+"/file/upload?type=ticket_reply","#customer_id"),$("#add_ticket_btn").on("click",function(){1==$("#add_ticket_form").valid()&&($(".spinner").show().css("line-height","0"),$("#spinnerText").text(jsLang("Please wait...")),$(this).attr("disabled",!0),$("#add_ticket_form").trigger("submit"))})}if($(".main-body .page-wrapper").find("#edit-ticket-container").length&&($(function(){$("#assign_name").val($("#customer_id option:selected").attr("data-name")),$("#assign_email").val($("#customer_id option:selected").attr("data-email"))}),$(document).on("change","#customer_id",function(){$("#assign_name").val($("option:selected",this).attr("data-name")),$("#assign_email").val($("option:selected",this).attr("data-email"))}),$("body").on("click",".delete_file_field",function(){$(this).parents(".control-group").remove()}),$("#edit-ticket-form").validate({ignore:[],rules:{subject:{required:!0},project_id:{required:!0},assign_id:{required:!0},department_id:{required:!0},priority_id:{required:!0},customer_id:{required:!0}}}),$("select").on("change",function(){""!=$(this).val()&&$(this).valid()})),$(".main-body .page-wrapper").find("#ticket-list-container").length&&($("#daterange-btn").daterangepicker(daterangeConfig(startDate,endDate),cbRange),cbRange(startDate,endDate),$(document).on("click","#csv",function(t){t.preventDefault(),window.location=SITE_URL+"/ticket_csv?from="+$("#startfrom").val()+"&to="+$("#endto").val()+"&project="+$("#project").val()+"&department_id="+$("#department_id").val()+"&status="+$("#status").val()+"&assignee="+$("#assignee").val()}),$(document).on("click","#pdf",function(t){t.preventDefault(),window.location=SITE_URL+"/ticket_pdf?from="+$("#startfrom").val()+"&to="+$("#endto").val()+"&project="+$("#project").val()+"&department_id="+$("#department_id").val()+"&status="+$("#status").val()+"&assignee="+$("#assignee").val()}),$("#theModal").on("show.bs.modal",function(t){var e=$(t.relatedTarget),a=$(this);$("#theModalSubmitBtn").attr("data-task","").removeClass("delete-task-btn"),"Delete"==e.data("label")?(a.find("#theModalSubmitBtn").addClass("delete-task-btn").attr("data-task",e.data("id")).text(jsLang("Delete")).show(),a.find("#theModalLabel").text(e.data("title")),a.find(".modal-body").text(e.data("message"))):(a.find(".modal-body").html('<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'),a.find(".modal-body").load(e.data("remote")))}),$("#theModalSubmitBtn").on("click",function(){$("#delete-item-"+$(this).data("task")).trigger("submit")}),$(window).on("load",function(){$(window).width()<576&&$("#headerDiv").addClass("pb-3")}),$("body").tooltip({selector:'[data-toggle="tooltip"]'}),$(document).on("click",".ticket_status_change",function(){var t=$(this).attr("data-id"),e=$(this).attr("ticket_id"),a=$(this).attr("data-value");ticketStatusChange(SITE_URL+"/ticket/change-status",t,e,a)})),$(".main-body .page-wrapper").find("#reply-ticket-container").length){var editorValue,editorNote,stack=[];hideNoDiv(),$(document).on("click",".status_change",function(){var t=$(this).attr("data-id"),e=$(this).attr("ticket_id");$.ajax({url:SITE_URL+"/ticket/change-status",method:"POST",data:{status_id:t,ticketId:e,_token:token},dataType:"json",success:function(t){if(1==t.status){$("#status_label").html(t.newName),$("#status_label").css("color",t.newStatusColor),$("#ticket-status").html(t.newName),$("#ticket-status").removeClass("text-white").css("color",t.newStatusColor);var a=t.newName;$.ajax({url:SITE_URL+"/ticket/get-status",method:"POSt",data:{statusName:a,ticketId:e,_token:token},dataType:"json",success:function(t){1==t.status?($("#removeLi ul").empty(),$("#removeLi ul").append(t.output)):swal(jsLang("Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})}else swal(jsLang("Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})}),validateCKEditor("#ticket_messages","#ticket_messages-error"),$("#reply_form").validate({ignore:[],rules:{message:{CKEditorRequired:!0}},submitHandler:function(){return $(".spinner").show().css("line-height","0"),$("#spinnerText").text(jsLang("Please wait...")),$("#btnSubmit").attr("disabled",!0),!0}}),$(function(){var t=$("#customer_id option:selected").attr("data-name");$("#customer_id option:selected").attr("data-email");$("#assign_name").val(t)}),ClassicEditor.create(document.querySelector("#reply-modal")).then(t=>{editorValue=t,theEditor=intialData=t.getData(),t.model.document.on("change",()=>{let e=intialData=t.getData();if(e=e.replace(/&nbsp;/g,"").replace("<p>","").replace("</p>","").replace(/^\s+|\s+$/g,""),theEditor=e,0==e.length)return $("#reply-modal-error").show().html(jsLang("This field is required.")),!1;$("#reply-modal-error").hide().html("")})}).catch(t=>{}),$(".edit-btn").on("click",function(){editorValue.setData($(this).attr("data-message"));$(".ck-content").children("p.first").val();$("#reply_id").val($(this).attr("data-id")),$("#update_type").val($(this).attr("data-type"))}),$("#replyModal").validate({ignore:[],rules:{message:{CKEditorRequired:!0}}}),ClassicEditor.create(document.querySelector("#txtAreaNote")).then(t=>{editorNote=t,theEditor=intialData=t.getData(),t.model.document.on("change",()=>{let e=intialData=t.getData();if(e=e.replace(/&nbsp;/g,"").replace("<p>","").replace("</p>","").replace(/^\s+|\s+$/g,""),theEditor=e,0==e.length)return $("#txtAreaNote-error").show().html(jsLang("This field is required.")),!1;$("#txtAreaNote-error").hide().html("")})}).catch(t=>{}),$("#noteForm").validate({ignore:[],rules:{message:{CKEditorRequired:!0}}}),$("#modal-note").on("show.bs.modal",function(){editorNote.setData($("#txtAreaNote").attr("data-message")),$("#txtAreaNote-error").hide()}),$(document).on("change","#assignee",function(){var t=$("#assignee").val()?$("#assignee").val():null,e=$("#customer_id").val(),a=SITE_URL+"/ticket/change-assignee";$.ajax({url:a,method:"POST",data:{user_id:t,customer_id:e,ticket_id:ticket_id,_token:token},dataType:"json",beforeSend:function(){swal({title:jsLang("Loading..."),text:$("#assignee option:selected").text()+", "+jsLang("assigning to this ticket"),buttons:!1})},success:function(e){"1"==e.status?($("#assignee").val(t).trigger("change"),swal($("#assignee option:selected").text()+jsLang(" successfully assigned"),{icon:"success",buttons:[!1,jsLang("Ok")]})):"2"==e.status&&($("#assignee").val(t).trigger("change"),swal(jsLang(" please check your email configuration"),{icon:"error",buttons:[!1,jsLang("Ok")]}))}})}),$("body").on("click",".delete_file_field",function(){$(this).parents(".control-group").remove()}),deleteAttachment(SITE_URL+"/file/remove"),uploadAttachment(SITE_URL+"/file/upload?type=ticket_reply","#customer_id"),$(document).on("click",".ticket_priority_change",function(){var t=$(this).attr("data-id"),e=$(this).attr("ticket_id"),a=$(this).attr("data-value");ticketPriorityChange(SITE_URL+"/ticket/priority-status",t,e,a)}),$("#reply_form").validate({ignore:[],rules:{message:{CKEditorRequired:!0}}}),$(document).on("click",".project-name-change",function(){var t=$(this).attr("data-value"),e=SITE_URL+"/ticket/change-project",a=SITE_URL+"/project/details/"+$(this).attr("data-id");$.ajax({url:e,method:"post",data:{projectId:$(this).attr("data-id"),ticketId:$(this).attr("ticket_id"),_token:token},dataType:"json",success:function(e){if(1==e.status)$("#removeLiProject ul").empty(),$("#removeLiProject ul").append(e.output),$(".project-name").html(t),$(".project-url").html(t),$(".project-url").attr("href",a);else{$(".noti-alert").append('<div class="alert alert-danger"><button type="button" class="close" data-dismiss="alert">Ã—</button><strong>Something went wrong, please try again.</strong></div>'),$("#notifications").css("display","block")}}})})}
