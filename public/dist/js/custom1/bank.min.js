"use strict";if($(".main-body .page-wrapper").find("#bank-account-type-container").length||$(".select").select2(),$(".main-body .page-wrapper").find("#bank-add-container").length&&$(document).ready(function(){$("#bank-add-container #bank").validate({rules:{account_name:{required:!0},account_type_id:{required:!0},account_no:{required:!0,allowed:!0},bank_name:{required:!0},opening_balance:{required:!0},currency_id:{required:!0}}})}),$(".main-body .page-wrapper").find("#bank-add-container,#bank-edit-container").length&&jQuery.validator.addMethod("allowed",function(e,a){return this.optional(a)||/^[. ()0-9]+$/.test(e)},jsLang("Allow only digits, white-spaces, first-brackets and dots")),$("input").on("keyup",function(){$(this).valid()}),$(document).on("change",".account_type",function(e){""!=$(e.currentTarget).val()?$("#error_account_type_id").hide():$("#error_account_type_id").show()}),$(document).on("change",".currency",function(e){""!=$(e.currentTarget).val()?$("#error_currency_id").hide():$("#error_currency_id").show()}),$(document).on("keyup change","#account_no, #account_name",function(){var e=$("#account_no").val(),a=$("#account_name").val(),n=$("#account_id").val();$.ajax({url:SITE_URL+"/bank/account_validation",type:"get",data:{id:n,account_no:e,account_name:a},success:function(e){1==e.status?$("#error_account_no").addClass("error").text(jsLang("That Bank Account is already taken.")).show():($("#error_account_no").hide(),$("#error_account_no").removeClass("error"))}})}),$("#bank-add-container #btnSubmit").on("click",function(){1==$("#bank").valid()&&($(".spinner").show(),$(".spinner").css("line-height","0"),$("#spinnerText").text(jsLang("Please wait...")),$(this).attr("disabled",!0),$("#bank").trigger("submit"))}),$(".main-body .page-wrapper").find("#bank-edit-container").length&&($(document).ready(function(){$("#date").removeClass("sorting_asc").addClass("sorting_disabled"),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){$($.fn.dataTable.tables(!0)).DataTable().columns.adjust().responsive.recalc()})}),$("#daterange-btn").daterangepicker(daterangeConfig(startDate,endDate),cbRange),cbRange(startDate,endDate),$(function(){$("#bank-edit-container #dataTableBuilder").DataTable({columnDefs:[{orderable:!1,visible:!1,targets:0},{orderable:!1,targets:1},{orderable:!1,targets:2},{orderable:!1,targets:3},{orderable:!1,targets:4},{orderable:!1,targets:5},{orderable:!1,targets:6}],order:[[0,"asc"]],language:{url:app_locale_url},pageLength:row_per_page})}),$("#bank-edit-container #bank").validate({rules:{account_name:{required:!0},account_type_id:{required:!0},account_no:{required:!0,allowed:!0},bank_name:{required:!0},bank_gl_account:{required:!0}}}),$(document).on("click","#bank-edit-container #csv, #bank-edit-container #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/bank_statement_"+this.id+"?to="+$("#endto").val()+"&from="+$("#startfrom").val()+"&account_no="+account_no+"&mode="+$("#mode").val()+"&type="+$("#type").val()}),$("#bank-edit-container input").on("keyup",function(){$(this).valid()}),$("#bank-edit-container #currency_div").on("click",function(){$("#currency_error_message").html('<label for="currency_id" class="error">'+jsLang("Currency not changeable!")+"</label>")}),$("#bank-edit-container #currency_div").mouseleave(function(){$("#currency_error_message label").fadeOut(1e3)})),$(".main-body .page-wrapper").find(".list-container").length&&($(document).on("click",".list-container #csv, .list-container #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/all_bank_report_"+this.id}),$("body").tooltip({selector:'[data-toggle="tooltip"]'}),$(".list-container #dataTableBuilder").addClass("account-list")),$(".main-body .page-wrapper").find("#bank-account-type-container").length&&($(".edit-acc-type").on("click",function(){var e=$(this).attr("id");$("#type_id").val($(this).attr("id")),$.ajax({url:SITE_URL+"/edit-acc-type",data:{id:e,_token:token},type:"POST",dataType:"JSON",success:function(e){$("#type_id").val(e.id),$("#type_name").val(e.name),$("#type_name").attr("data-id",e.id),$("#edit-acc-type").modal()}})}),$("#addAccType").validate({rules:{name:{required:!0,remote:SITE_URL+"/acc-type-valid"}}}),$("#add-acc-type").on("hidden.bs.modal",function(){$("input[name=name]").removeClass("error")}),$("#editAccType").validate({rules:{name:{required:!0,remote:{url:SITE_URL+"/acc-type-valid",type:"GET",data:{type_id:function(){return $("input[name=type_id]").val()}}}}}}),$("#add-acc-type").on("hidden.bs.modal",function(e){$(this).find("input[name=name]").val(""),$("#addAccType").validate().resetForm()}),$("#edit-acc-type").on("show.bs.modal",function(e){$("#editAccType").validate().resetForm()}),$("#edit-acc-type").on("hidden.bs.modal",function(e){$("input[name=name]").removeClass("error")}),$(document).ready(function(){$(".btn-group").hide(),$("#confirmDelete").on("show.bs.modal",function(e){var a=$(e.relatedTarget),n=$(this);$("#confirmDeleteSubmitBtn").attr("data-task","").removeClass("delete-task-btn"),"Delete"==a.data("label")&&(n.find("#confirmDeleteSubmitBtn").addClass("delete-task-btn").attr("data-task",a.data("id")).text(jsLang("Delete")).show(),n.find("#confirmDeleteLabel").text(a.data("title")),n.find(".modal-body").text(a.data("message"))),$("#confirmDeleteSubmitBtn").on("click",function(){$("#delete-accType-"+$(this).data("task")).trigger("submit")})})})),$(".main-body .page-wrapper").find("#orderListFilter").length&&($(document).on("click","#csv, #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/bank_account/transfer_"+this.id+"?to="+$("#endto").val()+"&from="+$("#startfrom").val()+"&from_bank_id="+$("#from_bank_id").val()+"&to_bank_id="+$("#to_bank_id").val()}),$(document).on("change","#from_bank_id",function(e){var a=$("#from_bank_id").val(),n=$("#to_bank_id").val();$.ajax({url:SITE_URL+"/bank_account/source-destination/accounts",type:"post",data:{_token:token,source:a},success:function(e){if(1==e.status){var a="";$.each(e.toAccount,function(e,t){a+=`<option value="${t.id}" ${t.id==n?"selected":""} > ${t.name} ${"("+t.currency.name+")"}</option>`}),$("#to_bank_id option").each(function(){$(this).remove()}),$("#to_bank_id").append('<option value="">To Bank A/c</option>',a)}}})}),$(document).on("change","#to_bank_id",function(e){var a=$("#from_bank_id").val(),n=$("#to_bank_id").val();$.ajax({url:SITE_URL+"/bank_account/source-destination/accounts",type:"post",data:{_token:token,to:n},success:function(e){if(2==e.status){var n="";$.each(e.fromAccount,function(e,t){n+=`<option value="${t.id}" ${t.id==a?"selected":""}> ${t.name} ${"("+t.currency.name+")"}</option>`}),$("#from_bank_id option").each(function(){$(this).remove()}),$("#from_bank_id").append('<option value="">From Bank A/c</option>',n)}}})}),$("#dataTableBuilder").addClass("transfer-list")),$(".main-body .page-wrapper").find("#bank-transfer-detail-container").length&&$("#dataTableBuilder").DataTable({ordering:!1}),$(".main-body .page-wrapper").find("#bank-transfer-add-container").length){function numberRound(e){return e.toFixed(2)}function calculateExchangeRate(){$("#destination-error").hide();var e=$("#amount").val(),a=""!=$("#exchange_rate").val()?$("#exchange_rate").val():0;let n=$("option:selected","#source").attr("currency-id"),t=$("option:selected","#destination").attr("currency-id");var r=$("input[name=from_acount_balance]").val();""!=$("#source").val()&&""!=e&&(parseFloat(validateNumbers(e))>parseFloat(r)?($("#insufficient_amount").css("display","block").html(jsLang("Insufficient balance")),$("#submit").attr("disabled","disabled")):($("#insufficient_amount").css("display","none"),$("#submit").removeAttr("disabled"))),""==e&&"undefined"==e||""==a&&"undefined"==a||"undefined"==n||"undefined"==t||n==t||$("#incoming_amount").val(getDecimalNumberFormat(parseFloat(validateNumbers(e))*parseFloat(a)))}$(".select2").select2().on("change",function(){$(this).valid(),$("#destination-error").hide()}),$("#trans_date").daterangepicker(dateSingleConfig()),$("#transfer").validate({rules:{source:{required:!0},destination:{required:!0},trans_date:{required:!0},amount:{required:!0},bank_charge:{required:!0},incoming_amount:{required:!1},exchange_rate:{required:!0}}}),$(".incoming_amount_div").hide(),$(".error").hide(),$("#source").on("change",function(){var e=$(this).val(),a=SITE_URL+"/transfer-dependent";$.ajax({url:a,method:"POST",data:{source:e,_token:token}}).done(function(e){1==(e=JSON.parse(e)).status_no&&($("#destination").html(e.destination).trigger("change"),$(".incoming_amount_div").hide(),$("#exchange_rate_div").css("display","none"))})}),$("#source").on("change",function(){$("#destination-error").hide();var e=validateNumbers($("input[name=amount]").val());let a=$(this).val(),n=$("option:selected",this).attr("currency-id"),t=$("option:selected",this).attr("currency-code"),r=$("#trans_date").val();if(""==a||""==n)$('label[for="source"]').css("display","block"),$(".message").removeClass("text-success").html("");else{var i=SITE_URL+"/get/balance";$.ajax({url:i,method:"POST",data:{account_no:a,date:r,_token:token},dataType:"json",success:function(a){1==a.status&&($(".message").removeClass("text-danger").addClass("text-success").html("<strong>"+jsLang("Current Balance")+": "+getDecimalNumberFormat(a.balance)+" "+t+"</strong>"),$("#bank_charge_currency").html(t),$("#transfer_bank_currency").html(t),$("#from_acount_balance").val(a.balance),""!=$("input[name=amount]").val()&&(parseFloat(e)>parseFloat(a.balance)?($("#insufficient_amount").css("display","block").html(jsLang("Insufficient balance")),$("#submit").attr("disabled","disabled")):($("#insufficient_amount").css("display","none"),$("#submit").removeAttr("disabled"))))}})}}),$(document).on("input change","#amount, #source, #bank_charge, #exchange_rate",function(){$("#destination-error").hide(),$("#insufficient_amount").css("display","none");var e=$("input[name=from_acount_balance]").val(),a=validateNumbers($("input[name=amount]").val()),n=validateNumbers($("input[name=bank_charge]").val());""!=$("input[name=amount]").val()&&""!=$("#source").val()?(calculateExchangeRate(),parseFloat(a)+parseFloat(n)>parseFloat(e)?($("#insufficient_amount").css("display","block").html(jsLang("Insufficient balance")),$("#submit").attr("disabled","disabled")):($("#insufficient_amount").css("display","none"),$("#submit").removeAttr("disabled"))):$("#insufficient_amount").css("display","none")}),$("#destination").on("change",function(){let e=$("option:selected","#source").attr("currency-id"),a=$("option:selected","#source").attr("currency-code"),n=$(this).val(),t=$("option:selected",this).attr("currency-id"),r=$("option:selected",this).attr("currency-code"),i=$("#trans_date").val();if("undefined"!=e&&"undefined"!=t&&e!=t&&""!=e&&""!=t&&$.ajax({method:"POST",url:SITE_URL+"/get-exchange-rate",data:{fromCurrency:e,toCurrency:t,_token:token},dataType:"json",success:function(e){$("#exchange_rate").val(e),calculateExchangeRate()}}),""==n||""==t)$('label[for="destination"]').css("display","block"),$(".messageDestination").removeClass("text-success").html(""),$("#transfer_bank_currency, #bankFeeCode, #exchange_rate_div").css("display","none"),$(".incoming_amount_div").hide();else{var o=SITE_URL+"/get/balance";$.ajax({url:o,method:"POST",data:{account_no:n,date:i,_token:token},dataType:"json",success:function(n){1==n.status&&($(".messageDestination").removeClass("text-danger").addClass("text-success").html("<strong>"+jsLang("Current Balance")+": "+getDecimalNumberFormat(n.balance)+" "+r+"</strong>"),e==t?($("#exchange_rate").rules("remove","required"),$("#exchange_rate").removeAttr("required"),$("div .dynamicRow").empty(),$(".incoming_amount_div").hide(),$("#transfer_bank_currency, #bank_charge_currency").html(a),$("#transfer_bank_currency, #currencyCode, #bankFeeCode").css("display","flex"),$("#exchange_rate_div").css("display","none"),$("#outgoing_currency_id, #incoming_currency_id").val(e)):e!=t&&($("#exchange_rate").rules("add","required"),$("div .dynamicRow").empty(),$("div .dynamicRow").append('<input type="text" placeholder="'+jsLang("Incoming Amount")+'" class="form-control positive-float-number" id="incoming_amount" name="incoming_amount" readonly>'),$("div .dynamicRow").append('<div class="input-group-prepend"><span class="input-group-text" id="incoming_bank_currency"></span></div>'),$("#incoming_bank_currency, #exchange_rate_currency_code").html(r),$(".incoming_amount_div").show(),$("#exchange_rate_div, #bankFeeCode, #transfer_bank_currency").css("display","flex"),$("#bank_charge_currency, #transfer_bank_currency").html(a),$("#outgoing_currency_id").val(e),$("#incoming_currency_id").val(t)))}})}})}
