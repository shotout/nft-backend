"use strict";if($(".main-body .page-wrapper").find("#project-list-container").length||$(".main-body .page-wrapper").find("#project-task-container").length)var oldMembers="";if($(".main-body .page-wrapper").find("#milestone-add-container").length||$(".main-body .page-wrapper").find("#milestone-edit-container").length){oldMembers="";var from="",to=""}if($(".main-body .page-wrapper").find("#project-list-container").length&&($(document).on("click","#csv, #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/project_"+this.id+"?from="+$("#startfrom").val()+"&to="+$("#endto").val()+"&status="+$("#status").val()+"&project_type="+$("#project_type").val()}),$("#dataTableBuilder").addClass("project-list-styles")),$(".main-body .page-wrapper").find("#project-add-container").length||$(".main-body .page-wrapper").find("#project-edit-container").length){$(".select2").select2(),$("#project_tag").select2({tags:!0}),ClassicEditor.create(document.querySelector(".text-editor")).catch(e=>{}),$(window).on("load",function(){if($(".custom_error_show").hide(),$(".main-body .page-wrapper").find("#project-add-container").length){var e=$(window).width();e<576&&($(".row").addClass("mb-0"),$(".custom_error_show").removeClass("pl-3"))}e>429&&$(".rowAddForText").addClass("row")}),$("#project_from").validate({rules:{project_name:{required:!0},project_type:{required:!0},customer_id:{required:!1},status:{required:!0},"members[]":{required:!0},start_date:{required:!0}},invalidHandler:function(e,t){$(".custom_error_show").show()}}),$("#members").select2({placeholder:jsLang("Nothing selected"),allowClear:!0}),$(".main-body .page-wrapper").find("#project-edit-container").length&&($(function(){var e=$("#customer_id option:selected"),t=e.attr("data-name"),a=e.attr("data-email");$("#assign_name").val(t),$("#assign_email").val(a)}),1==taskExist&&$("#charge_type").prop("disabled",!0)),$(document).on("change","#customer_id, #project_type",function(){var e=!0,t=$("option:selected",this),a=t.attr("data-name"),r=t.attr("data-email");if($("#assign_name").val(a),$("#assign_email").val(r),$(".main-body .page-wrapper").find("#project-add-container").length){/^[a-zA-Z0-9]+[a-zA-Z0-9_.-]+[a-zA-Z0-9_-]+@[a-zA-Z0-9]+[a-zA-Z0-9.-]+[a-zA-Z0-9]+.[a-z]{2,}$/.test(r)||(e=!1),""!=r&&1==e?$("#emailCheckboxDiv").css("display","flex"):$("#emailCheckboxDiv").css("display","none")}}),$(".main-body .page-wrapper").find("#project-add-container").length&&($("#startDate, #endDate").daterangepicker(dateSingleConfig()),$("#endDate").val("")),$(".main-body .page-wrapper").find("#project-edit-container").length&&($("#startDate").daterangepicker(dateSingleConfig($("#startDate").val())),""!=$("#endDate").val()?$("#endDate").daterangepicker(dateSingleConfig($("#endDate").val())):($("#endDate").daterangepicker(dateSingleConfig()),$("#endDate").val("")));var type=$("#project_type").val();function changePermission(){"customer"==$("#project_type").val()?$("#permission_div").show():$("#permission_div").hide()}"customer"==type?$(".cusDiv").show():"product"==type?$(".cusDiv").hide():"in_house"==type&&$(".cusDiv").hide(),$(document).on("change","#project_type",function(){var e=$(this).val();""==e?$("#project_type_error").css("display","block"):$("#project_type_error").css("display","none"),"customer"==e?($(".cusDiv").show(),$(".permission").show()):"product"==e?($(".customerCheck").prop("checked",!1),$(".cusDiv").hide(),$(".permission").hide()):"in_house"==e&&($(".customerCheck").prop("checked",!1),$(".cusDiv").hide(),$(".permission").hide())}),$("#total_cost_div").css("display","flex"),$("#rate_per_hour_div").css("display","none"),"1"==$("#charge_type").val()?$("#total_cost").rules("add","required"):"2"==$("#charge_type").val()?($("#total_cost_div").css("display","none"),$("#rate_per_hour_div").css("display","flex"),$("#total_cost").rules("remove","required"),$("#rate_per_hour").rules("add","required")):"3"==$("#charge_type").val()&&($("#total_cost_div, #rate_per_hour_div").css("display","none"),$("#total_cost").rules("remove","required"),$("#rate_per_hour").rules("remove","required")),$(document).on("change","#charge_type",function(){$("#total_cost").rules("remove","required");var e=$(this).val();"1"==e?($("#total_cost_div").css("display","flex"),$("#rate_per_hour_div").css("display","none"),$("#total_cost").rules("add","required"),$("#rate_per_hour").rules("remove","required")):"2"==e?($("#total_cost_div").css("display","none"),$("#rate_per_hour_div").css("display","flex"),$("#total_cost").rules("remove","required"),$("#rate_per_hour").rules("add","required")):"3"==e&&($("#total_cost_div, #rate_per_hour_div").css("display","none"),$("#total_cost").rules("remove","required"),$("#rate_per_hour").rules("remove","required"))}),$(window).on("load",function(){changePermission()}),$("#project_type").on("change",function(){changePermission()}),$(document).on("change","#startDate, #endDate",function(){""!=$("#startDate").val()&&""!=$("#endDate").val()&&(Date.parse($("#startDate").val())>Date.parse($("#endDate").val())?$("#endDate-error").html(jsLang("The end date cannot be before the start date.")).css("display","block"):$("#endDate-error").html("").css("display","none"))}),$(document).on("click","#btnSubmit",function(){if(""!=$("#startDate").val()&&""!=$("#endDate").val()){if(Date.parse($("#startDate").val())>Date.parse($("#endDate").val()))return $("#endDate-error").html(jsLang("The end date cannot be before the start date.")).css("display","block"),$("#endDate").focus(),!1;$("#endDate-error").html("").css("display","none")}1==$("#project_from").valid()&&($(".spinner").show(),$(".spinner").css("line-height","0"),$("#spinnerText").text(jsLang("Please wait...")),$(this).attr("disabled","disabled"),$("#project_from").trigger("submit"))}),$(document).on("change","#status",function(){""!=$("#status").val()?$("#status_error").css("display","none"):$("#status_error").css("display","block")}),$(document).on("change","#members",function(){""!=$("#members").val()?$("#members_error").css("display","none"):$("#members_error").css("display","block")})}var editEditor,theEditor,editorValue;($(".main-body .page-wrapper").find("#project-overview-container").length&&($(window).on("load",function(){$(window).width()<576&&($("#border-right-1").removeClass("border-right"),$("div.card-block.m-t-10").addClass("ml-2"))}),$(".progressbar").each(function(){$(this).offset().top,$(window).scrollTop();var e=$(this).find(".circle").attr("data-percent");parseInt(e,10),parseInt(100,10),$(this).data("animate");$(this).data("animate",!0),$(this).find(".circle").circleProgress({startAngle:-Math.PI/2,value:e/100,thickness:14,fill:{color:"#1dc4e8"}}).on("circle-animation-progress",function(e,t,a){$(this).find("div").text((100*a).toFixed(1)+"%")}).stop()}),$("#members").select2({dropdownParent:$("#parent")}),$(document).on("click","#memberSetting",function(){$("#memberSettingModal").modal()}),$("#memberSettingModal").on("show.bs.modal",function(){$(".member_class").val(oldMembers).trigger("change")}),$(document).on("click","#show-more",function(){"show-more"==$(this).attr("data-title")?($(this).text(jsLang("SHOW LESS")),$("#projectDetailsLess").show(),$("#initial").hide(),$("#show-more").attr("data-title","show-less")):($(this).text(jsLang("SHOW MORE")),$("#projectDetailsLess").hide(),$("#initial").show(),$("#show-more").attr("data-title","show-more"))}),$("#editMember").validate({rules:{"members[]":{required:!0}}}),$(document).on("change","#members",function(){""!=$("#members").val()?$("#members_error").css("display","none"):$("#members_error").css("display","block")})),$(".main-body .page-wrapper").find("#project-task-container").length&&($(".js-example-basic-single").select2(),$("#daterange-btn").daterangepicker(daterangeConfig(startDate,endDate),cbRange),cbRange(startDate,endDate),$("#theModal").on("show.bs.modal",function(e){var t=$(e.relatedTarget),a=$(this);if($("#theModalSubmitBtn").attr("data-task","").removeClass("delete-task-btn"),"Delete"==t.data("label"))a.find("#theModalSubmitBtn").addClass("delete-task-btn").attr("data-task",t.data("id")).text(jsLang("Delete")).show(),a.find("#theModalLabel").text(t.data("title")),a.find(".modal-body").text(t.data("message"));else{a.find(".modal-body").html('<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'),a.find(".modal-body").load(t.data("remote"))}}),$("#theModalSubmitBtn").on("click",function(){$("#delete-item-"+$(this).data("task")).trigger("submit")}),$(document).on("click","#csv, #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/projectTask"+this.id.charAt(0).toUpperCase()+this.id.slice(1)+"?from="+$("#startfrom").val()+"&to="+$("#endto").val()+"&assignee="+$("#assignee").val()+"&status="+$("#status").val()+"&priority="+$("#priority").val()+"&project="+projectId})),($(".main-body .page-wrapper").find("#project-task-add-container").length||$(".main-body .page-wrapper").find("#project-task-edit-container").length)&&($(".js-example-responsive").select2({tags:!0}),$(".main-body .page-wrapper").find("#project-task-add-container").length&&(deleteAttachment(SITE_URL+"/file/remove?type=task"),uploadAttachment(SITE_URL+"/file/upload?type=task","#user_id"),$(window).on("load",function(){$(window).width()<=1e3&&($(".col-sm-8").addClass("col-sm-12"),$(".col-sm-8").removeClass("col-sm-8"),$(".col-sm-8").addClass("col-sm-8"),$(".col-sm-8").removeClass("col-sm-8"),$(".col-sm-3").addClass("col-sm-4"),$(".col-sm-3").removeClass("col-sm-3"))})),$("#project_task_form").validate({rules:{task_name:{required:!0},start_date:{required:!0},task_details:{required:!0}}}),$("#startDate").daterangepicker(dateSingleConfig()),""!=$("#dueDate").val()?$("#dueDate").daterangepicker(dateSingleConfig($("#dueDate").val())):($("#dueDate").daterangepicker(dateSingleConfig()),$("#dueDate").val("")),$("#dueDate").daterangepicker(dateSingleConfig()),$("#dueDate").val(""),$("#assign_me").on("click",function(){var e=$("#assignee").val();e.push(loggedUserId),$("#assignee").val(e).trigger("change")}),$(document).on("change","#assignee",function(){var e=$("#assignee").val();0==jQuery.inArray(loggedUserId,e)?$("#assign_me").hide():0!=jQuery.inArray(loggedUserId,e)&&$("#assign_me").show()}),$("#priority, #assignee, #status").select2(),$("#customer").select2({placeholder:jsLang("Select a customer"),allowClear:!0}),$("#milestone").select2(),$("#assignee").select2({placeholder:jsLang("Nothing selected"),allowClear:!0}),$("#checklistAddBtn").on("click",function(e){e.preventDefault();var t=$("#myInput").val();if(""===t)return swal(jsLang("Empty checklist"),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1;if(t.length<5)return swal(jsLang("Too Short checklist"),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1;if($(".main-body .page-wrapper").find("#project-task-edit-container").length)$.ajax({type:"POST",url:SITE_URL+"/checklist_edit/add",token:token,data:{task_id:$("#task_id").val(),title:t,_token:token},dataType:"json",success:function(e){if("success"==e.message){var t="<li class='checkbox checkbox-primary'><input type='checkbox' name='todo-item-done' class='todo-item-done' id='checklist_status_"+e.item.id+"' value='"+e.item.title+"'  /><label for='checklist_status_"+e.item.id+"' class='cr f-12'><span class='checklist_label cursor_text' data-id='"+e.item.id+"' title='Click to edit'>"+e.item.title+"</span><span class='todo-item-delete text-c-red f-18' id='"+e.item.title+"'><i class='feather icon-trash-2'></i></span></label></li>";$("#myUL").append(t),$("#myInput").val("")}else swal(e.message,{icon:"error",buttons:[!1,jsLang("Ok")]})}});else if($(".main-body .page-wrapper").find("#project-task-add-container").length){var a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("id",t),a.setAttribute("value",t),a.setAttribute("name","allCheckListHiidenInput[]"),document.getElementById("checklistCollector").appendChild(a),$("#myUL").append("<li id='"+t+"'>"+t+" <span class='todo-item-delete text-c-red f-18' id='"+t+"'><i class='feather icon-trash-2'></i></span></li>"),$("#myInput").val("")}}),$(".main-body .page-wrapper").find("#project-task-edit-container").length&&$(document).on("click",".todo-item-done",function(){var e=$(this).attr("id");e=e.split("_")[2];var t=$(this).is(":checked");$.ajax({type:"POST",url:SITE_URL+"/checklist/change_status",token:token,data:{id:e,status:t,_token:token},success:function(t){"success"==t.message&&(1==t.item.is_checked?$("span[data-id="+e+"]").addClass("strike"):$("span[data-id="+e+"]").removeClass("strike"))}})}),$("#myUL").on("click",".todo-item-delete",function(e){var t=this;if($(".main-body .page-wrapper").find("#project-task-edit-container").length)swal({title:jsLang("Are you sure?"),text:jsLang("Once deleted, you will not be able to recover this checklist."),icon:"warning",buttons:[jsLang("Cancel"),jsLang("Ok")],dangerMode:!0}).then(e=>{if(e){$(this).parent(),$(".attachment").parent(),$(".attachment-delete").parent();var a=t.id;$.ajax({type:"POST",url:SITE_URL+"/checklist/delete",token:token,data:$(project_task_form).serialize()+"&id="+a,dataType:"json",success:function(e){if("success"==e.message){for(var a=document.getElementById("checklistCollector").getElementsByTagName("input"),r=0;r<a.length;r++)a[r].value==t.id&&a[r].remove();$(t).parent().fadeOut("fast",function(){$(t).parent().remove()}),swal(jsLang("Success! Checklist has been deleted."),{icon:"success",buttons:[!1,jsLang("Ok")]})}}})}});else if($(".main-body .page-wrapper").find("#project-task-add-container").length){for(var a=document.getElementById("checklistCollector").getElementsByTagName("input"),r=0;r<a.length;r++)a[r].value==t.id&&a[r].remove();$(t).parent().fadeOut("fast",function(){$(t).parent().remove()})}}),$(document).on("change","#startDate, #dueDate",function(){var e=$("#startDate").val(),t=$("#dueDate").val();""!=e&&""!=t&&(Date.parse(e)>Date.parse(t)?$("#due_date-error").html(jsLang("The due date cannot be before the start date.")).css("display","block"):$("#due_date-error").html("").css("display","none"))}),$(document).on("click","#btnSubmit",function(){var e=$("#startDate").val(),t=$("#dueDate").val();if(""!=e&&""!=t){if(Date.parse(e)>Date.parse(t))return $("#due_date-error").html(jsLang("The due date cannot be before the start date.")).css("display","block"),$("#dueDate").focus(),!1;$("#due_date-error").html("").css("display","none")}1==$("#project_task_form").valid()&&($(this).attr("disabled","disabled"),$("#project_task_form").trigger("submit"))}),""!=projectChargeType&&3==projectChargeType?($("#hourly_rate_div").css("display","flex"),$("#hourly_rate").rules("add","required")):($("#hourly_rate_div").css("display","none"),$("#hourly_rate").rules("remove","required"))),$(".main-body .page-wrapper").find("#project-timesheet-container").length&&$(document).on("click","#csv, #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/project/timersheet/"+this.id+"?project="+projectId}),$(".main-body .page-wrapper").find("#project-milestone-container").length&&($(document).on("click","#csv, #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/project/milestones/"+this.id+"?project="+projectId}),$("#dataTableBuilder").addClass("milestone-list")),($(".main-body .page-wrapper").find("#milestone-add-container").length||$(".main-body .page-wrapper").find("#milestone-edit-container").length)&&(ClassicEditor.create(document.querySelector("#description")),$("#milestone_form").validate({rules:{name:"required",due_date:"required"}}),$("#dueDate").daterangepicker(dateSingleConfig())),$(".main-body .page-wrapper").find("#project-files-container").length&&($("#dataTableBuilder_length").remove(),uploadAttachment(SITE_URL+"/project/files/store","#project_id",".dropzone-attachments",!0)),$(".main-body .page-wrapper").find("#project-ticket-list-container").length&&($(".select2").select2(),$("#daterange-btn").daterangepicker(daterangeConfig(startDate,endDate),cbRange),cbRange(startDate,endDate),$(document).on("click","#csv, #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/ticket_"+this.id+"?from="+$("#startfrom").val()+"&to="+$("#endto").val()+"&project="+projectId+"&department_id="+$("#department_id").val()+"&status="+$("#status").val()}),$("#dataTableBuilder").addClass("project-ticket-list-styles"),$(document).on("click",".ticket_status_change",function(){var e=$(this).attr("data-id"),t=$(this).attr("ticket_id");ticketStatusChange(SITE_URL+"/ticket/change-status",e,t)}),$(document).on("click",".ticket_priority_change",function(){var e=$(this).attr("data-id"),t=$(this).attr("ticket_id");ticketPriorityChange(SITE_URL+"/ticket/priority-status",e,t)})),$(".main-body .page-wrapper").find("#project-invoice-list-container").length&&($("#daterange-btn").daterangepicker(daterangeConfig(startDate,endDate),cbRange),cbRange(startDate,endDate),$(document).on("click","#csv, #pdf",function(e){e.preventDefault(),window.location=SITE_URL+"/project_invoice_"+this.id+"?from="+$("#startfrom").val()+"&to="+$("#endto").val()+"&project="+projectId})),$(".main-body .page-wrapper").find("#project-note-container").length)&&($("#update-note").validate({ignore:[],rules:{content:{CKEditorRequired:!0},subject:{required:!0}}}),$("#addNote").validate({ignore:[],rules:{content:{CKEditorRequired:!0},subject:{required:!0}}}),validateCKEditor("#note_add_messages","#note_add_messages-error"),ClassicEditor.create(document.querySelector("#note_content_edit")).then(e=>{editorValue=e,theEditor=e.getData(),e.model.document.on("change",()=>{let t=e.getData();if(t=t.replace(/&nbsp;/g,"").replace("<p>","").replace("</p>","").replace(/^\s+|\s+$/g,""),theEditor=t,0==t.length)return $("#note_content_edit-error").show().html(jsLang("This field is required.")),!1;$("#note_content_edit-error").hide().html("")})}).catch(e=>{}),$(".edit-btn").on("click",function(){var e=$(this).attr("data-id");$("#id").val(e),$("#note-id").html(e),$.ajax({url:SITE_URL+"/project/notes/edit/"+e,type:"GET",success:function(e){var t=JSON.parse(e);$("#note_subject_edit").val(t.subject),$("#note_content_edit").html(t.content),editorValue.setData(t.content)}})}),$("#modal-default").on("show.bs.modal",function(){$("#update-note").validate().resetForm()}),$("#theModal").on("show.bs.modal",function(e){var t=$(e.relatedTarget),a=$(this);if($("#theModalSubmitBtn").attr("data-task","").removeClass("delete-task-btn"),"Delete"==t.data("label"))a.find("#theModalSubmitBtn").addClass("delete-task-btn").attr("data-task",t.data("id")).text(jsLang("Delete")).show(),a.find("#theModalLabel").text(t.data("title")),a.find(".modal-body").text(t.data("message"));else{a.find(".modal-body").html('<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'),a.find(".modal-body").load(t.data("remote"))}}),$("#theModalSubmitBtn").on("click",function(){$("#delete-item-"+$(this).data("task")).trigger("submit")}));
