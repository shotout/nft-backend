"use strict";function clickOnSave(e=null,t=null,n=[]){$.ajax({type:t,url:SITE_URL+e,data:{_token:token,array_value:n},success:function(e){1==e.status?swal(jsLang("Successfully Saved"),{icon:"success",buttons:[!1,jsLang("Ok")]}):(e.error,swal(e.error,{icon:"error",buttons:[!1,jsLang("Ok")]}))}})}function hideNoDiv(){$("#no_div_msg").hide(),$("#no_div_link").hide()}function dataTable(e,t){$(e).DataTable({columnDefs:[{targets:t,orderable:!1}],language:{url:app_locale_url},pageLength:row_per_page})}function confirmDelete(e,t,n,a){$(e).on("show.bs.modal",function(e){var i=$(e.relatedTarget),l=$(this);$(t).attr("data-task","").removeClass("delete-task-btn"),"Delete"==i.data("label")&&(l.find(t).addClass("delete-task-btn").attr("data-task",i.data("id")).text(jsLang("Delete")).show(),l.find(n).text(i.data("title")),l.find(".modal-body").text(i.data("message"))),$("#confirmDeleteSubmitBtn").on("click",function(){$(a+$(this).data("task")).trigger("submit")})})}var cannedEditorValue,cannedEditorValueEdit;ClassicEditor.create(document.querySelector("#txtAreaCanned")).then(e=>{cannedEditorValue=e,theEditor=intialData=e.getData(),e.model.document.on("change",()=>{let t=intialData=e.getData();if(t=t.replace(/&nbsp;/g,"").replace("<p>","").replace("</p>","").replace(/^\s+|\s+$/g,""),theEditor=t,0==t.length)return $("#reply-modal-error").show().html(jsLang("This field is required.")),!1;$("#reply-modal-error").hide().html("")})}).catch(e=>{}),ClassicEditor.create(document.querySelector("#txtAreaCannedEdit")).then(e=>{cannedEditorValueEdit=e,theEditor=intialData=e.getData(),e.model.document.on("change",()=>{let t=intialData=e.getData();if(t=t.replace(/&nbsp;/g,"").replace("<p>","").replace("</p>","").replace(/^\s+|\s+$/g,""),theEditor=t,0==t.length)return $("#reply-modal-error").show().html(jsLang("This field is required.")),!1;$("#reply-modal-error").hide().html("")})}).catch(e=>{});var jsonData=[];function isUrlValid(e){return null!=e.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/g)}function customLinkValidation(){let e,t,n,a,i,l,o,d,r=0,s=$("input[name='row_identify[]']").map(function(){return $(this).val()}).get();for(let c=0;c<s.length;c++){e=0,l=0,o=0,d=0;let u=0;$.each($("#link-title-"+s[c]),function(){$(this).val()&&($(this).val().length<150&&(l=1),u=1),$("#link-"+s[c]).val()&&($("#link-"+s[c]).val().length<255&&(o=1),isUrlValid($("#link-"+s[c]).val())&&(d=1),e=1)}),0==e&&0==o&&0==d?($("#link-"+s[c]).addClass("err1"),$("#link-text-"+s[c]).text(jsLang("This field is required.")),t=1):1==e&&0==o&&0==d?($("#link-"+s[c]).addClass("err1"),$("#link-text-"+s[c]).text(jsLang("Please provide at most 255 characters.")),a=1):1==e&&1==o&&0==d?($("#link-"+s[c]).addClass("err1"),$("#link-text-"+s[c]).text(jsLang("Please enter a valid link.")),i=1):($("#link-"+s[c]).removeClass("err1"),$("#link-text-"+s[c]).text("")),0==u&&0==l?($("#link-title-"+s[c]).addClass("err1"),$("#link-title-text-"+s[c]).text(jsLang("This field is required.")),r=1):1==u&&0==l?($("#link-title-"+s[c]).addClass("err1"),$("#link-title-text-"+s[c]).text(jsLang("Please provide at most 150 characters.")),n=1):($("#link-title-"+s[c]).removeClass("err1"),$("#link-title-text-"+s[c]).text(""))}return 1!=t&&1!=r&&1!=n&&1!=a&&1!=i}if($("#cannedForm").validate({ignore:[],rules:{canned_message:{CKEditorRequired:!0},title:{required:!0,maxlength:150}}}),$("#cannedForm").on("submit",function(e){if(e.preventDefault(),1==$("#cannedForm").valid()){let e=$("#title").val();clickOnSave("/canned/messages/save","POST",jsonData={title:e,editorValue:theEditor}),$("#modal-canned").modal("hide"),document.getElementById("cannedForm").reset(),void 0!==$("#type").val()&&"list"==$("#type").val()&&setTimeout(location.reload.bind(location),1500)}}),$(document).on("click",".deleteCustomLink",function(e){e.preventDefault();var t=$(this).attr("data-row-id");$("#rowid-"+t).remove()}),$("#linkForm").on("submit",function(e){let t,n;e.preventDefault();let a=0,i=0;void 0!==$("#type").val()&&"reply"==$("#type").val()?1==customLinkValidation()&&(t=$("input[name='link[]']").map(function(){return $(this).val()}).get(),n=$("input[name='title[]']").map(function(){return $(this).val()}).get(),a=1,jsonData={title:n,editorValue:t}):1==$("#linkForm").valid()&&(t=$("#link").val(),n=$("#title").val(),a=1,i=1,jsonData={title:n,editorValue:t,status:"link_list"}),1==a&&(clickOnSave("/canned/links/save","POST",jsonData),$("#modal-link").modal("hide"),1==i&&setTimeout(location.reload.bind(location),1500))}),$("#linkForm").validate({ignore:[],rules:{link:{required:!0,regexLink:!0,maxlength:255},title:{required:!0,maxlength:150}}}),$(".main-body .page-wrapper").find("#canned-message-settings-container").length&&($(document).on("click",".edit_canned_message",function(){var e=$(this).attr("id");$.ajax({url:SITE_URL+"/canned/messages/edit",data:{id:e,_token:token},type:"POST",dataType:"JSON",success:function(e){$("#edit_title").val(e.title),$("#canned_id").val(e.id),cannedEditorValueEdit.setData(e.message)}})}),$("#editMessageForm").validate({ignore:[],rules:{canned_message:{CKEditorRequired:!0},title:{required:!0,maxlength:150}}}),$("#editMessageForm").on("submit",function(e){if(e.preventDefault(),1==$("#editMessageForm").valid()){let e=$("#edit_title").val(),t=$("#canned_id").val();clickOnSave("/canned/messages/update","POST",jsonData={id:t,title:e,editorValue:cannedEditorValueEdit.getData()}),$("#edit-canned-message").modal("hide"),setTimeout(location.reload.bind(location),1500)}}),$("#modal-canned").on("hidden.bs.modal",function(e){$(this).find("input[name=title]").val(""),$(this).find("textarea[name=canned_message]").text(""),$("#cannedForm").validate().resetForm(),$(this).find("input[name=title]").removeClass("error"),$(this).find("textarea[name=canned_message]").removeClass("error")}),$("#edit-canned-message").on("show.bs.modal",function(e){$("#editMessageForm").validate().resetForm()}),$("#edit-lead-source").on("hidden.bs.modal",function(e){$(this).find("input[name=title]").removeClass("error"),$(this).find("textarea[name=canned_message]").removeClass("error")}),dataTable("#dataTableBuilder",3),confirmDelete("#confirmDelete","#confirmDeleteSubmitBtn","#confirmDeleteLabel","#delete-canned-")),$(".main-body .page-wrapper").find("#canned-links-settings-container").length&&($(document).on("click",".edit_canned_link",function(){var e=$(this).attr("id");$.ajax({url:SITE_URL+"/canned/links/edit",data:{id:e,_token:token},type:"POST",dataType:"JSON",success:function(e){$("#edit_link").val(e.link),$("#edit_title").val(e.title),$("#link_id").val(e.id)}})}),$("#editLinkForm").validate({ignore:[],rules:{link:{required:!0,regexLink:!0,maxlength:255},title:{required:!0,maxlength:150}}}),$("#editLinkForm").on("submit",function(e){if(e.preventDefault(),1==$("#editLinkForm").valid()){let e=$("#edit_title").val(),t=$("#edit_link").val(),n=$("#link_id").val();clickOnSave("/canned/links/update","POST",jsonData={id:n,title:e,editorValue:t,status:"link_list"}),$("#edit-canned-link").modal("hide"),setTimeout(location.reload.bind(location),1500)}}),$("#modal-link").on("hidden.bs.modal",function(e){$(this).find("input[name=title]").val(""),$(this).find("input[name=link]").val(""),$("#linkForm").validate().resetForm(),$(this).find("input[name=title]").removeClass("error"),$(this).find("input[name=link]").removeClass("error")}),$("#edit-canned-link").on("show.bs.modal",function(e){$("#editLinkForm").validate().resetForm()}),$("#edit-canned-link").on("hidden.bs.modal",function(e){$(this).find("input[name=title]").removeClass("error"),$(this).find("input[name=link]").removeClass("error")}),dataTable("#dataTableBuilder",3),confirmDelete("#confirmDelete","#confirmDeleteSubmitBtn","#confirmDeleteLabel","#delete-canned-")),$(".main-body .page-wrapper").find("#reply-ticket-container").length||$(".main-body .page-wrapper").find("#cus-panel-ticket-reply-container").length){function urlify(e){let t=[];let n=0;return e.replace(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/g,function(e){t[n++]=e}),t}function autoCompleteSource(e=null,t=null,n=null,a=null,i=null){let l=$(a).val();$.ajax({url:n,dataType:"json",type:"POST",data:{_token:token,search:l},success:function(e){if(1==e.status_no){e=e.canned;$(i).css("display","none"),t($.map(e,function(e){return{id:e.id,value:e.filter_data,fullValue:e.data}}))}else $(".ui-menu-item").remove(),$(i).css("top",$(a).position().top+35),$(i).css("left",$(a).position().left),$(i).css("width",$(a).width()),$(i).css("display","block")}})}$("#cannedLink_search").autocomplete({delay:500,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(e,t){autoCompleteSource(e,t,SITE_URL+"/canned/search/link","#cannedLink_search","#no_div_link")},select:function(e,t){var n=t.item;if(n.id){let e;return e=theEditor.length>13?theEditor+n.fullValue:n.fullValue,theEditorObj.setData(e),this.value="",!1}},minLength:1,autoFocus:!0}),$("#cannedMsg_search").autocomplete({delay:500,position:{my:"left top",at:"left bottom",collision:"flip"},source:function(e,t){autoCompleteSource(e,t,SITE_URL+"/canned/search/message","#cannedMsg_search","#no_div_msg")},select:function(e,t){var n=t.item;if(n.id){let e;return e=theEditor.length>13?theEditor+n.fullValue:n.fullValue,theEditorObj.setData(e),this.value="",!1}},minLength:1,autoFocus:!0}),$(".main-body .page-wrapper").find("#reply-ticket-container").length&&($(".canned-btn").on("click",function(){cannedEditorValue.setData($(this).attr("data-message"));$(".ck-content").children("p.first").val()}),$(document).on("click","#canned_msg",function(e){e.preventDefault(),cannedEditorValue.setData(theEditor)}),$(document).on("click","#canned_link",function(e){e.preventDefault();let t=urlify(theEditor);if(t.length>0){jsonData={editorValue:t};let e="",n=1;for(let a=0;a<t.length;++a)e+=`\n                          <div class="row customLinkDiv" id="rowid-${n}">\n                             <div class="col-md-5 col-sm-5 padding-bottom">\n                                <label class="col-sm-2 control-label require">${jsLang("Title")}</label>\n                                <input type="text" data-rel="${n}" data-text="link-title-text" name="title[]" class="form-control" id="link-title-${n}">\n                                <span id="link-title-text-${n}" class="validationMsg"></span>\n                             </div>\n                             <div class="col-md-6 col-sm-6">\n                                 <label class="col-sm-2 control-label require">${jsLang("Link")}</label>\n                                <input type="text" data-rel="${n}" data-text="link-text" name="link[]" value="${t[a]}" class="form-control" id="link-${n}">\n                                <span id="link-text-${n}" class="validationMsg"></span>\n                             </div>\n                             <input type="hidden" name="row_identify[]" value="${n}">\n                             <div class="col-md-1 co-sm-1">\n                                <label>${jsLang("Action")}</label>\n                                <button type="button" data-row-id="${n}" class="btn btn-xs btn-danger m-t-5 deleteCustomLink"><i class="fa fa-trash"></i></button>\n                             </div>\n                           </div>`,n++;$("#custom_link").empty(),$("#custom_link").append(e),$("#modal-link").modal("show")}else swal(jsLang("Does not find any link!"),{icon:"error",buttons:[!1,jsLang("Ok")]})})),$("#modal-canned").on("show.bs.modal",function(){$(this).find("input[name=title]").val(""),$(this).find("textarea[name=canned_message]").text(""),$("#cannedForm").validate().resetForm(),$(this).find("input[name=title]").removeClass("error"),$(this).find("textarea[name=canned_message]").removeClass("error")})}jQuery.validator.addMethod("regexLink",function(e,t){var n=new RegExp(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/g);return this.optional(t)||n.test(e)},jsLang("Please enter a valid link."));
