"use strict";if($("#theModal").on("shown.bs.modal",function(){$("#customerAdd").validate().resetForm(),$("#theModalSubmitBtn").prop("disabled",!1)}),$("#theModalBody").hasClass("modal-body-content")){function emailValidation(){var t,e=SITE_URL+"/email-valid-customer",a=$("#email").val(),o=$("#token").val();return validateEmail(a)&&($("#email-error").html(""),$.ajax({url:e,data:{_token:o,email:a},type:"POST",success:function(e){"true"!=e?($("#email-error").css("display","block").text(jsLang("This email is already existed.")),$("#theModalSubmitBtn").prop("disabled",!0),t=0):($("#email-error").html(""),$("#theModalSubmitBtn").prop("disabled",!1),t=1)},error:function(t,e,a){return 0}})),t}$(".select2-dropdown").select2({dropdownParent:$("#theModalBody")}),$("#customerAdd").validate({ignore:"ui-tabs-hide",rules:{first_name:{required:!0,minlength:3,maxlength:30},last_name:{required:!0,minlength:3,maxlength:30},email:{regxEmailValidation:!0},currency_id:{required:!0},phone:{required:!1,regxPhone:!0}},highlight:function(){$('[href="#home"]').tab("show")},submitHandler:function(){$.ajax({type:"POST",url:$("#customerAdd").attr("action"),data:$("#customerAdd").serialize(),dataType:"json",success:function(t){1==t.status?($("#customers").hasClass("invoice-customers")?($("#customers").append(' <option value="'+t.customer.id+'" data-currency_id="'+t.customer.currency_id+'" data-symbol="'+t.customer.currency_symbol+'" data-name="'+t.customer.currency_name+'" selected>'+t.customer.name+" ("+t.customer.currency_name+")</option>").trigger("change"),$("#show_currency").val(t.customer.currency_name),$("#inv-currency").val(t.customer.currency_id)):$("#customers").append(' <option selected value="'+t.customer.id+'">'+t.customer.name+"</option>").trigger("change"),$("#holdModal").modal("toggle"),$("#theModal").modal("toggle")):swal(t.errors,{icon:"error",buttons:[!1,jsLang("Ok")]})},error:function(){swal(jsLang("Oops! Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})}}),$("#email").on("keyup",function(){null==$("#email-error").val()&&$("#email-error").html("")}),jQuery.validator.addMethod("regxPhone",function(t,e){var a=new RegExp(/^((\+\d{1,4}(-| )?\(?\d\)?(-| )?\d{1,9})|(\(?\d{2,9}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/),o=new RegExp(/^[+0-9 () \-]{8,20}$/);return this.optional(e)||a.test(t)||o.test(t)},jsLang("Enter a valid phone number")),$(document).ready(function(){$("#email").on("keyup",function(){$("#email-error").html(""),""!=$(this).val()?emailValidation():$("#theModalSubmitBtn").prop("disabled",!1)})}),$("#copy").on("click",function(){$("#ship_street").val($("#bill_street").val()),$("#ship_city").val($("#bill_city").val()),$("#ship_state").val($("#bill_state").val()),$("#ship_zipCode").val($("#bill_zipCode").val()),$("#ship_country_id").val($("#bill_country_id").val()).trigger("change")}),$("#currency").on("change",function(){""==$(this).val()?$("#currency-error").css("display","flex"):$("#currency-error").hide()}),$(document).on("change","#bill_country_id",function(){""!=$("#bill_country_id  option:selected").val()&&null!=$("#bill_country_id  option:selected").val()?$("#bill_country_id-error").css("display","none"):$("#bill_country_id-error").css("display","flex")}),jQuery.validator.addMethod("regxEmailValidation",function(t,e){return this.optional(e)||validateEmail(t)},jsLang("Enter a valid email"))}if($("#add-shipping-modal").hasClass("modal-body-content")){var customerID=$("#customers").val();function getBranchAddress(t,e){$.ajax({type:"POST",url:SITE_URL+"/pos/customer-branch",data:{_token:t,id:e},success:function(t){localStorage.setItem("shippingDetail",t);var e=JSON.parse(t);e&&($("#name").val(e.name),$("#ship_email").val(e.email),$("#ship_street").val(e.customer_branch.shipping_street),$("#ship_city").val(e.customer_branch.shipping_city),$("#ship_state").val(e.customer_branch.shipping_state),$("#ship_zipCode").val(e.customer_branch.shipping_zip_code),$("#ship_country_id").val(e.customer_branch.shipping_country_id).trigger("change"))}})}$(document).ready(function(){var t=localStorage.getItem("shippingDetail");"0"!=t.length&&(t=JSON.parse(t),$("#name").val(t.name),$("#ship_email").val(t.ship_email),$("#ship_street").val(t.ship_street),$("#ship_city").val(t.ship_city),$("#ship_state").val(t.ship_state),$("#ship_zipCode").val(t.ship_zipCode),$("#ship_country_id").val(t.ship_country_id).trigger("change"))}),$(".btn_add_shipping").on("click",function(){$("#holdModal").modal("hide")}),$("#ship_country_id").select2({disabled:!0,dropdownParent:$("#holdModal-body")}),""!=customerID&&getBranchAddress(token,customerID)}if($("#discountModalBody").hasClass("modal-body-content")&&($("#discount_type").select2({dropdownParent:$("#discountModalBody")}),$("#discount_amount").val($("#net_discount").val()),$("#discount_type").val($("#net_discount_type").val()),$("#discount_type").trigger("change"),$("#discount_type").on("change",function(){$(".discount-type-prepend").text($("#discount_type :selected").val())}),$("#discount_amount").on("keyup",function(){"%"==$("#discount_type :selected").val()&&parseFloat(validateNumbers($("#discount_amount").val()))>100&&(swal(jsLang("Discount amount can not be more than 100%"),{icon:"error"}),$("#discount_amount").val("")),"$"==$("#discount_type :selected").val()&&$("#discount_amount").val()>parseFloat(validateNumbers($("#net_payable_no_currency").text()))&&(swal(jsLang("Discount amount can not be more than the total amount"),{icon:"error"}),$("#discount_amount").val(""))})),$("#payment-modal").hasClass("modal-body-content")){$(document).ready(function(){$(".card-section").hide(),$(".cheque-section").hide(),$("#payment_type").select2({dropdownParent:$("#payment-modal")})});var totalAmount=0;if($("#holdModalResetBtn").hasClass("btn_hold_pay")){totalAmount=$("#holdModal").find(".btn_hold_pay").attr("hold_total_amount");var order_id=$("#holdModal").find(".btn_hold_pay").attr("hold_order_id");$("#holdPayModalSubmitBtn").attr("order_amount",totalAmount),$("#holdPayModalSubmitBtn").attr("order_id",order_id)}else totalAmount=$("#net_payable").text();$(".order_amount").val(totalAmount);var input_amount=0;$(document).on("change",".payment_type",function(t){var e=$(this).val();"card"==e?($(".cheque-section").hide(),$(".card-section").show(),$("#cheque_number").val("")):"cheque"==e?($(".card-section").hide(),$(".cheque-section").show(),$("#card_number").val("")):($(".card-section").hide(),$(".cheque-section").hide(),$("#cheque_number").val(""),$("#card_number").val(""))}),$(document).keyup("#amount_received",delay(function(t){var e=parseFloat(validateNumbers($("#amount_received").val()))-parseFloat(validateNumbers(totalAmount));e<0&&(e=0),$(".return_amount").val(getDecimalNumberFormat(e))},300)),$(".order_payment").on("click",function(){var t=$("#payment_type").val(),e=$("#additional_data").val(),a=$("#card_number").val(),o=$("#cheque_number").val();return"card"==t&&""===a?($("#card_number").focus(),swal(jsLang("Card number can not be empty"),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1):"cheque"==t&&""===o?($("#cheque_number").focus(),swal(jsLang("Cheque number can not be empty"),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1):"card"!=t&&"cheque"!=t||""!==e?void 0:($("#additional_data").focus(),swal(jsLang("Additional data can not be empty"),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1)}),$("#payment_date").daterangepicker(dateSingleConfig())}if($("#order-hold-modal").hasClass("modal-body-content")){var orderResponse="";function resetForm(){$("#hold_name").text(jsLang("Order Details")),$(".author").text(""),$(".orderDate").text(""),$(".customer_name").text(""),$(".orderNo").text(""),$(".total_order_amount").text(""),$(".hold_order_details table tbody").html(""),$(".hold_order_details table tfoot").html("")}$("#holdModal").on("shown.bs.modal",function(t){t.preventDefault()}),$(document).ready(function(){$("#holdModal").find(".single_hold_item").first().trigger("click")}),$(document).on("click",".single_hold_item",function(t){t.preventDefault(),$(".single_hold_items").removeClass("hold_item_active"),$(this).parent().addClass("hold_item_active");var e=$(this).parent().attr("data-order_id"),a=$(this).text(),o=SITE_URL+"/pos/getHoldOrderDetails";$.ajax({type:"POST",url:o,data:{_token:token,orderId:e},success:function(t){if(1==t.status){orderResponse=t,$("#hold_name").text(jsLang("Order Details")+" - "+a),$(".author").text(t.user),$(".orderDate").text(moment(orderResponse.order.order_date).format(dateFormat.replace(/M/g,"MMM").toUpperCase())),null!=orderResponse.order.customer_id?$(".customer_name").text(orderResponse.order.customer.first_name+" "+orderResponse.order.customer.last_name):$(".customer_name").text(jsLang("Walking customer")),$(".orderNo").text(orderResponse.order.reference),$(".total_order_amount").text(orderResponse.order.total);let d=orderResponse.order.sale_order_details,i=orderResponse.order;for(var e,o="",n="",r=0;r<d.length;r++)n=Number.isInteger(d[r].quantity)?d[r].quantity:getDecimalNumberFormat(d[r].quantity),o=o+"<tr><td>"+d[r].item_name+"</td><td class='text-right'>"+getDecimalNumberFormat(d[r].unit_price)+"</td><td align='right'>"+n+"</td><td align='right'>"+getDecimalNumberFormat(d[r].quantity*d[r].unit_price)+"</td></tr>";e="<tr align='right'><td colspan='3'>"+jsLang("Tax")+"</b></td><td class='total_tax'>"+decimalNumberFormatWithCurrency(i.total_tax_amount)+"</td></tr><tr align='right'><td colspan='3'><b>"+jsLang("Shipping")+"</b></td><td class='shipping_cost'>"+decimalNumberFormatWithCurrency(i.shipping_charge)+"</td></tr><tr align='right'><td colspan='3'><b>"+jsLang("Discount")+"</b></td><td class='discount_on_cart'>"+decimalNumberFormatWithCurrency(i.total_discount_amount)+"</td></tr><tr align='right'><td colspan='3'><b>"+jsLang("Total Amount")+"</b></td><td class='total_order_amount'>"+decimalNumberFormatWithCurrency(t.order.total)+"</td></tr>",$(".hold_order_details table tbody").html(o),$(".hold_order_details table tfoot").html(e),$(".btn_hold_pay").attr("hold_total_amount",t.order.total),$(".btn_hold_pay").attr("hold_order_id",t.order.id)}else swal(jsLang("failed"),{icon:"error",buttons:[!1,jsLang("Ok")]})},error:function(){swal(jsLang("Oops! Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})}),$(document).on("click",".delete_hold_item",function(t){t.preventDefault();var e=$(this).parent(),a=parseInt($(this).parent().attr("data-order_id")),o=SITE_URL+"/pos/delete-hold-item";swal({title:jsLang("Are you sure to delete this?"),icon:"warning",buttons:[jsLang("Cancel"),jsLang("Ok")],dangerMode:!0}).then(t=>{t&&$.ajax({url:o,method:"POST",data:{id:a,_token:token},success:function(t){t>0?($("#order_hold_search").trigger("keyup"),e.remove(),0==$(".hold_item_active").length&&resetForm(),0==$(".hold_items").find(".single_hold_item").length&&$("#holdModalSubmitBtn, #holdModalResetBtn").attr("disabled",!0)):swal({title:jsLang("Delete failed"),icon:"warning",buttons:[jsLang("Ok")],dangerMode:!0})}})})}),$("#order_hold_search").keyup(delay(function(t){t.preventDefault();var e=$(this).val(),a=SITE_URL+"/pos/hold-item-search";$.ajax({method:"POST",url:a,data:{keyword:e,_token:token},success:function(t){var e=JSON.parse(t),a="";$.each(e,function(t,e){var o="";o=null!=e.pos_order_title?e.pos_order_title:jsLang("Unknown"),a+='<div class="single_hold_items row" data-order_id="'+e.id+'"><div class="single_hold_item">'+o+'</div><div class="delete_hold_item"><span class="feather icon-trash-2 text-danger" title="Delete"></span></div></div>'}),$(".hold_items").html(a)}})},500)),0==$(".hold_items").find(".single_hold_item").length&&$("#holdModalSubmitBtn, #holdModalResetBtn").attr("disabled",!0)}if($("#settingsModalBody").hasClass("modal-body-content")){var storageTaxType=localStorage.getItem("taxType"),discountOn=localStorage.getItem("discountOn");$("#discount_on").select2({dropdownParent:$("#settingsModalBody")}),$("#tax_type").select2({dropdownParent:$("#settingsModalBody")}),""!=storageTaxType&&null!=storageTaxType||(storageTaxType="exclusive"),""!=discountOn&&null!=discountOn||(discountOn="before"),$("[data-label='pos-settings']").attr("data-settings-tax",storageTaxType),$("[data-label='pos-settings']").attr("data-settings-discount",discountOn),$("#discount_on").val(discountOn),$("#tax_type").val(storageTaxType),$("#discount_on").trigger("change"),$("#tax_type").trigger("change")}$("#add-note-modal").hasClass("modal-body-content")&&$("#order_note").val(localStorage.getItem("order_note")),$("#put-order-on-hold").hasClass("modal-body-content")&&($(".order_amount").val($("#net_payable").text()),$("#order_title").val(""));
